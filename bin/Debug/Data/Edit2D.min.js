/*!
 * LMV v7.3.0
 * 
 * Copyright 2019 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.Edit2D=function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=436)}({1:function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",n=e[3];if(!n)return i;if(t&&"function"==typeof btoa){var o=(s=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),r=n.sources.map((function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"}));return[i].concat(r).concat([o]).join("\n")}var s;return[i].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i})).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(n[r]=!0)}for(o=0;o<e.length;o++){var s=e[o];"number"==typeof s[0]&&n[s[0]]||(i&&!s[2]?s[2]=i:i&&(s[2]="("+s[2]+") and ("+i+")"),t.push(s))}},t}},18:function(e,t,i){"use strict";var n=i(6),o=0,r=1,s=7,a=new THREE.Vector2,l=new THREE.Box2;function h(e){this.segTypes=[],this.segData=[],this.hasCurves=!1,this.bbox=new THREE.Box2,this.precisionTolerance=e}h.prototype.closePath=function(){this.segTypes.length&&this.segTypes[this.segTypes.length-1]===s||this.segTypes.push(s)},h.prototype.moveTo=function(e,t){this.segTypes.push(o),this.segData.push(e,t),this.bbox.expandByPoint(a.set(e,t))},h.prototype.lineTo=function(e,t){this.segTypes.push(r),this.segData.push(e,t),this.bbox.expandByPoint(a.set(e,t))},h.prototype.arc=function(e,t,i,n,o,r){this.hasCurves=!0,this.segTypes.push(2),this.segData.push(e,t,i,n,o,r),this.bbox.expandByPoint(a.set(e,t))},h.prototype.arcTo=function(e,t,i,n,o){this.hasCurves=!0,this.segTypes.push(3),this.segData.push(e,t,i,n,o),this.bbox.expandByPoint(a.set(e,t)),this.bbox.expandByPoint(a.set(i,n))},h.prototype.quadraticCurveTo=function(e,t,i,n){this.hasCurves=!0,this.segTypes.push(4),this.segData.push(e,t,i,n),this.bbox.expandByPoint(a.set(e,t)),this.bbox.expandByPoint(a.set(i,n))},h.prototype.bezierCurveTo=function(e,t,i,n,o,r){this.hasCurves=!0,this.segTypes.push(5),this.segData.push(e,t,i,n,o,r),this.bbox.expandByPoint(a.set(e,t)),this.bbox.expandByPoint(a.set(i,n)),this.bbox.expandByPoint(a.set(o,r))},h.prototype.flatten=function(e){for(var t=new h(this.precisionTolerance),i=0,a=0,l=0,u=a,c=l,p=this.segTypes,d=this.segData,f=this.bbox.size().length(),y=0;y<p.length;y++){switch(p[y]){case o:e&&(a===u&&l===c||t.closePath()),u=a=d[i++],c=l=d[i++],t.moveTo(a,l);break;case s:t.closePath();break;case r:var v=d[i++],g=d[i++];v===a&&g===l||(t.lineTo(v,g),a=v,l=g);break;case 4:var m=d[i++],b=d[i++];v=d[i++],g=d[i++];Object(n.c)(t,a,l,m,b,v,g,f),a=v,l=g;break;case 5:m=d[i++],b=d[i++];var x=d[i++],k=d[i++];v=d[i++],g=d[i++];Object(n.b)(t,a,l,m,b,x,k,v,g,f),a=v,l=g;break;case 2:console.warn("not implemented: arc"),i+=6;break;case 3:console.warn("not implemented: arcto"),i+=4}}return e&&(a===u&&l===c||t.closePath()),t},h.prototype.stroke=function(e,t,i,n,a,l,h,u){if(l&&l.isAABBContain(this.bbox)===c)return;var p,d=this;(h||this.hasCurves)&&(d=this.flatten(!1)),h&&(p=e.getCurrentTransform());for(var f=0,y=0,v=0,g=0,m=0,b=d.segTypes,x=d.segData,k=0;k<b.length;k++){var S=b[k];switch(S){case o:g=y=x[f++],m=v=x[f++];break;case s:case r:var E=S===s?g:x[f++],w=S===s?m:x[f++];E===y&&w===v||(e.flushBuffer(4),h?e.currentVbb.addSegment(e.tx(y,v,p),e.ty(y,v,p),e.tx(E,w,p),e.ty(E,w,p),0,t,i,n,a,0,u):e.currentVbb.addSegment(y,v,E,w,0,t,i,n,a,0,u),y=E,v=w);break;default:console.error("Path must be flattened before rendering")}}},h.prototype.isAABB=function(){var e=this.segTypes;if(6!==e.length&&5!==e.length)return!1;if(e[0]!==o)return!1;if(6===e.length&&e[5]!==s)return!1;if(5===e.length&&e[4]!==s&&e[4]!==r)return!1;for(var t=1;t<e.length-1;t++)if(e[t]!==r)return!1;var i=this.segData,n=i[2]-i[0],a=i[3]-i[1],l=i[6]-i[4],h=i[7]-i[5],u=Math.sqrt(n*n+a*a),c=Math.sqrt(l*l+h*h);if(Math.abs(u-c)>1e-10)return!1;var p=(n/=u)*(l/=c)+(a/=u)*(h/=c);if(Math.abs(1+p)>.001)return!1;var d=i[4]-i[2],f=i[5]-i[3],y=i[8]-i[6],v=i[9]-i[7],g=Math.sqrt(d*d+f*f),m=Math.sqrt(y*y+v*v);return!(Math.abs(g-m)>1e-10)&&(p=(d/=g)*(y/=m)+(f/=g)*(v/=m),!(Math.abs(1+p)>.001)&&(p=n*d+a*f,!(Math.abs(p)>.001)&&!(Math.abs(n)>1e-10&&Math.abs(a))))};var u=1,c=2,p=4;function d(e,t,i){if(e.containsBox(t))return u;var n=i;return void 0===n&&(n=.001/e.size().length()),t.min.x-e.max.x>n?c:t.min.y-e.min.y>n?c:t.max.x-e.max.x<-n?c:t.max.y-e.max.y<-n?c:t.min.x-e.min.x<-n?p:t.min.y-e.min.y<-n?p:t.max.x-e.max.x>n?p:t.max.y-e.max.y>n?p:u}function f(e){if(!e.segTypes.length)return null;var t,i=Autodesk.Viewing.Extensions.CompGeom.ContourSet,n=Autodesk.Viewing.Extensions.CompGeom.UniquePointList,a=new i,l=new n(e.bbox),h=e.segTypes,u=e.segData,c=0,p=[];function d(e){if(e.length){var t=!1,i=e[0]===e[e.length-1];i&&e.length<=3&&(t=!0),i||console.log("Unexpected non-closed polygon contour"),t||a.addContour(e,!0)}}for(var f=0;f<h.length;f++){switch(h[f]){case o:d(p),t=l.findOrAddPoint(u[c],u[c+1]),c+=2,p=[t];break;case s:p[0]!==p[p.length-1]&&p.push(p[0]),d(p),p=[];break;case r:t=l.findOrAddPoint(u[c],u[c+1]),c+=2,t!==p[p.length-1]&&p.push(t);break;default:console.warn("Path must be flattened before triangulating.")}}return d(p),a.triangulate(),a}function y(e,t,i){var n=Autodesk.Viewing.Extensions.CompGeom.DCEL;i||(i="AND");var o=new n(e.bbox.clone().union(t.bbox),Math.min(e.precisionTolerance,t.precisionTolerance));e._addToDCEL(o,1),t._addToDCEL(o,2);var r=f(e),s=f(t);if(!r)return s;if(!s)return r;if(!r.contours.length)return"AND"===i?r:s;if(!s.contours.length)return"AND"===i?s:r;var a=r.polygon,l=s.polygon,h={pointInPolygon:function(){switch(i){case"AND":return function(e,t){return a.pointInPolygon(e,t)&&l.pointInPolygon(e,t)};case"XOR":return function(e,t){return a.quadTreeEdges.pointInPolygon(e,t)^l.quadTreeEdges.pointInPolygon(e,t)};case"OR":return function(e,t){return a.pointInPolygon(e,t)||l.pointInPolygon(e,t)};default:return}}()};return o.finalize(!0,h),o.closedAreas}function v(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}h.prototype.isAABBContain=function(e){return this.isAABB()?d(this.bbox,e,this.precisionTolerance):p},h.prototype._addToDCEL=function(e,t,i){for(var n=this.segTypes,a=this.segData,l=0,h=0,u=0,c=0,p=0,d=0;d<n.length;d++){switch(n[d]){case o:c===h&&p===u||e.addDirectedEdge(c,p,h,u,i,t),c=h=a[l++],p=u=a[l++];break;case s:e.addDirectedEdge(c,p,h,u,i,t);break;case r:var f=a[l++],y=a[l++];e.addDirectedEdge(c,p,f,y,i,t),c=f,p=y}}c===h&&p===u||e.addDirectedEdge(c,p,h,u,i,t)},h.prototype.cacheTriangulation=function(){var e;this.flattened=this.flatten(!0);var t=(e=f(this.flattened))?e.polygon:null;this.polygon=[t],t&&(this.flattened.polygon=this.polygon)},h.prototype.clip=function(e,t){var i,n=this,o=n.bbox,r=!1;if(e.isAABB()){var s=d(e.bbox,o,this.precisionTolerance);s===c?r=!0:s===u&&(i=n)}else if(n.isAABB()){var a=d(o,e.bbox,this.precisionTolerance);a===c?r=!0:a===u&&(i=e)}if(r)return null;if(i)return i;if(!r&&!i){console.log("Complex clipped clip.");for(var l=y(e,n,"AND"),p=new h(this.precisionTolerance),f=0;f<l.length;f++)for(var v=l[f],g=0;g<v.contours.length;g++){for(var m=v.contours[g],b=0;b<m.length;b++){var x=m[b].x,k=m[b].y;0===b?p.lineTo(x,k):p.moveTo(x,k)}p.closePath()}return p}},h.prototype.fill=function(e,t,i,n,o,r){var s,a=this.flattened||this.flatten(!0);o&&(s=o.flattened||o.flatten(!0),o.flattened=s);var h,p,v,g=a.polygon,m=this.bbox;r&&(h=e.getCurrentTransform(),m=e.transformBox(m,h,l));var b,x,k=!1,S=!1;if(r&&(S=!0),!S&&s){if(s.isAABB()){var E=d(s.bbox,m,this.precisionTolerance);E===c?k=!0:E===u&&(g||(p=f(a)).triangulationFailed||(v=a))}else if(a.isAABB()){var w=d(m,s.bbox,this.precisionTolerance);w===c?k=!0:w===u&&(g||(p=f(s)),p&&!p.triangulationFailed&&(v=s))}k||v||(p=y(s,a,"AND"))}else g||(p=f(a)),p&&p.triangulationFailed&&(b=a,x=new(0,Autodesk.Viewing.Extensions.CompGeom.DCEL)(b.bbox),b._addToDCEL(x,1,!1),x.finalize(!0),p=x.closedAreas),v=a;if(p&&(g=Array.isArray(p)?p.map((function(e){return e.polygon})):[p.polygon]),!k&&g){for(var P=0;P<g.length;P++){var T=g[P];if(T&&T.indices&&T.indices.length){for(var C=T.pts,A=[],_=0;_<C.length;_++){var L=C[_].x,V=C[_].y;r?A.push(e.tx(L,V,h),e.ty(L,V,h)):A.push(L,V)}e.addPolyTriangle(A,T.indices,t,i,n,!v),v&&v.stroke(e,-.5,t,i,n,null,r)}}!1}},i.d(t,"a",(function(){return C}));var g=Autodesk.Viewing,m=g.Private.VertexBufferBuilder;var b=new Array(6),x=new THREE.Vector2,k=new THREE.Box2,S=new THREE.Vector3,E=new THREE.Quaternion,w=new THREE.Vector3,P=new THREE.Vector3,T=new THREE.Matrix4,C=function(){function e(t,i,o,r,s,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var l,h,u=document.createElement("canvas"),c=u.getContext("2d");u.height=t.height,u.width=t.width,this.canvasContext=c,this.viewport=t,this.toPageUnits=i,this.meshCallback=o,this.currentMeshIndex=0,this.imageNumber=0,this.currentVbb=new m(!1),this._curPath=null,this._curClip=null,this.first=!0,this.states=[],this.glyphCache={},this.usingTextLayer=s,this.precisionTolerance=.1,this.dbId=-1,this.consecutiveIds=!1,g.isMobileDevice()&&Object(n.a)(void 0,.1),this.fontEngine=r,this.lineStyle=0,this.isScreenSpace=!1,l=c,h=this,["fillRect","strokeRect","clearRect","beginPath","closePath","moveTo","lineTo","arc","arcTo","quadraticCurveTo","bezierCurveTo","rect","fill","stroke","clip","strokeText","fillText","drawImage","save","restore","beginMarkedContent","beginMarkedContentProps","endMarkedContent"].forEach((function(e){l["_original"+e]=l[e],l[e]=h[e].bind(h)})),this.layers={},this.defaultLayerId=0,this.currentLayerId=this.defaultLayerId,this.sequencedDbId=-1,this.taggedId=null,this.ocgStack=[],this.idRemap=[],this.idIndexMap={},this.msdfRender=!0,this.fontAtlas=a}var t,i,o;return t=e,(i=[{key:"updateDBId",value:function(){null!=this.taggedId?null!=this.idIndexMap[this.taggedId]?this.dbId=this.idIndexMap[this.taggedId]:(this.sequencedDbId++,this.dbId=this.sequencedDbId,this.idRemap[this.dbId]=this.taggedId,this.idIndexMap[this.taggedId]=this.dbId):(this.consecutiveIds&&(this.sequencedDbId++,this.dbId=this.sequencedDbId),this.idRemap[this.dbId]=this.dbId)}},{key:"save",value:function(){this.states.push({clip:this._curClip,consecutiveIds:this.consecutiveIds,dbId:this.dbId}),this.canvasContext._originalsave()}},{key:"restore",value:function(){var e=this.states.pop();e&&(this._curClip=e.clip,this.consecutiveIds=e.consecutiveIds,this.dbId=e.dbId),this.canvasContext._originalrestore()}},{key:"flushBuffer",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.currentVbb.vcount||t){var n=t;if((n=n||this.currentVbb.isFull(e))&&this.currentVbb.vcount){var o=this.currentVbb.toMesh();o.material={skipEllipticals:!this.currentVbb.numEllipticals,skipCircles:!this.currentVbb.numCirculars,skipTriangleGeoms:!this.currentVbb.numTriangleGeoms,useInstancing:this.currentVbb.useInstancing,isScreenSpace:!this.currentImage,hasLineStyles:this.currentVbb.hasLineStyles,msdfFontTexture:!!i},this.currentImage&&(o.material.image=this.currentImage,o.material.image.name=this.currentImage.cacheKey||this.imageNumber++,o.material.opacity=this.canvasContext.globalAlpha,this.currentImage=null),this.meshCallback(o,this.currentMeshIndex++),this.currentVbb.reset(0),this.currentVbb.expandStride()}}}},{key:"addPolyTriangle",value:function(e,t,i,n,o,r){var s=this,a=null,l=0,h=-.5;function u(e,t){if(e>t){var i=e;e=t,t=i}if(a[e]){var n=a[e],o=n.lastIndexOf(t);-1==o?n.push(t):n[o]=-1}else a[e]=[t]}function c(t,r){if(t>r){var u=t;t=r,r=u}var c=a[t];c&&-1!=c.indexOf(r)&&(s.flushBuffer(4),s.currentVbb.addSegment(e[2*t],e[2*t+1],e[2*r],e[2*r+1],s.currentLayerId,h,i,n,o,l,s.lineStyle))}if(r){a=new Array(e.length/2);for(var p=0,d=t.length;p<d;p+=3){var f=t[p],y=t[p+1],v=t[p+2];u(f,y),u(y,v),u(v,f)}}if(this.currentVbb.useInstancing){var g=t.length;for(p=0;p<g;p+=3)f=t[p],y=t[p+1],v=t[p+2],this.flushBuffer(4),this.currentVbb.addTriangleGeom(e[2*f],e[2*f+1],e[2*y],e[2*y+1],e[2*v],e[2*v+1],i,n,o,l),r&&(c(f,y),c(y,v),c(v,f))}else{g=e.length/2,this.flushBuffer(g);var m=this.currentVbb,b=m.vcount;for(p=0;p<g;++p){var x=e[2*p],k=e[2*p+1];m.addVertexPolytriangle(x,k,i,n,o,l)}m.addIndices(t,b),r&&function(){for(var t=0,r=a.length;t<r;t++){var u=a[t];if(u)for(var c=0;c<u.length;c++){var p=u[c];-1!=p&&(s.flushBuffer(4),s.currentVbb.addSegment(e[2*t],e[2*t+1],e[2*p],e[2*p+1],s.currentLayerId,h,i,n,o,l,s.lineStyle))}}}()}}},{key:"getFillColor",value:function(){if("string"!=typeof this.canvasContext.fillStyle)return console.warn("Unsupported fill style."),0;var e=parseInt(this.canvasContext.fillStyle.slice(1),16);return 255*this.canvasContext.globalAlpha<<24|(255&e)<<16|65280&e|e>>16&255}},{key:"getStrokeColor",value:function(){var e=this.canvasContext;if(this.lastStrokeStyle===e.strokeStyle&&e.globalAlpha===this.lastAlpha)return this.lastRgb;var t=parseInt(e.strokeStyle.slice(1),16),i=255*e.globalAlpha<<24|(255&t)<<16|65280&t|t>>16&255;return this.lastRgb=i,this.lastStrokeStyle=e.strokeStyle,this.lastAlpha=e.globalAlpha,i}},{key:"getCurrentTransform",value:function(){var e=this.canvasContext.mozCurrentTransform;if(this.isFontChar){var t=this.invXform,i=e[0],n=e[1],o=e[2],r=e[3],s=e[4],a=e[5];return b[0]=t[0]*i+t[2]*n,b[1]=t[1]*i+t[3]*n,b[2]=t[0]*o+t[2]*r,b[3]=t[1]*o+t[3]*r,b[4]=t[0]*s+t[2]*a+t[4],b[5]=t[1]*s+t[3]*a+t[5],b}return e}},{key:"tx",value:function(e,t,i){return(e*(i=i||this.getCurrentTransform())[0]+t*i[2]+i[4])*(this.isFontChar?1:this.toPageUnits)}},{key:"ty",value:function(e,t,i){return(e*(i=i||this.getCurrentTransform())[1]+t*i[3]+i[5])*(this.isFontChar?1:this.toPageUnits)}},{key:"scaleValue",value:function(e,t){return t=t||this.getCurrentTransform(),this.toPageUnits*Math.sqrt(Math.abs(t[0]*t[3]-t[1]*t[2]))*e}},{key:"transformBox",value:function(e,t,i){return t=t||this.getCurrentTransform(),k.makeEmpty(),x.set(this.tx(e.min.x,e.min.y,t),this.ty(e.min.x,e.min.y,t)),k.expandByPoint(x),x.set(this.tx(e.max.x,e.min.y,t),this.ty(e.max.x,e.min.y,t)),k.expandByPoint(x),x.set(this.tx(e.max.x,e.max.y,t),this.ty(e.max.x,e.max.y,t)),k.expandByPoint(x),x.set(this.tx(e.min.x,e.max.y,t),this.ty(e.min.x,e.max.y,t)),k.expandByPoint(x),i?(i.copy(k),i):k.clone()}},{key:"fillRect",value:function(e,t,i,n){this.updateDBId();var o=this.getCurrentTransform(),r=[this.tx(e,t,o),this.ty(e,t,o),this.tx(e+i,t,o),this.ty(e+i,t,o),this.tx(e+i,t+n,o),this.ty(e+i,t+n,o),this.tx(e,t+n,o),this.ty(e,t+n,o)],s=this.getFillColor(),a=this.first?-1:this.dbId;this.addPolyTriangle(r,[0,1,2,0,2,3],s,a,this.currentLayerId,!1),this.first=!1}},{key:"strokeRect",value:function(e,t,i,n){console.log("strokeRect")}},{key:"clearRect",value:function(e,t,i,n){console.log("clearRect")}},{key:"_beginTextChar",value:function(e,t,i,n,o){!0!==this.usingTextLayer?(this.isFontChar=!0,this.invXform=this.canvasContext.mozCurrentTransformInverse,this.hashKey=e.charCodeAt(0)+"/"+n.loadedName+"/"+o,this.cachedGlyph=this.glyphCache[this.hashKey],this.cachedGlyph?this.skipPath=!0:this.skipPath=!1):this.skipPath=!0}},{key:"drawMSDFText",value:function(e,t,i,n,o){var r=n.name;if(this.fontAtlas&&this.fontAtlas.charsMap&&this.fontAtlas.charsMap[r]){var s=this.fontAtlas.charsMap[r][e.charCodeAt(0)];if(null==s)return!1;this.currentVbb.isFull(4)&&this.flushBuffer(0,!0);var a=this.fontAtlas.chars[s];if(a.page>0)return!1;for(var l=this.fontAtlas.common[a.common],h=o/this.fontAtlas.info[a.info].size,u=a.width*(h+0),c=a.inverseYAxis?-1:1,p=a.height*(h+i)*c,d=a.txoffset*(h+0),f=a.tyoffset*(h+i)*-c,y=[d,f,d,f+p,d+u,f+p,d+u,f],v=[],g=0;g<y.length;g+=2)v.push(this.tx(y[g],y[g+1])),v.push(this.ty(y[g],y[g+1]));if(a.inverseYAxis)var m=[a.x/l.scaleW,1-a.y/l.scaleH,a.x/l.scaleW,1-(a.y+a.height)/l.scaleH,(a.x+a.width)/l.scaleW,1-(a.y+a.height)/l.scaleH,(a.x+a.width)/l.scaleW,1-a.y/l.scaleH];else m=[a.x/l.scaleW,1-(a.y+a.height)/l.scaleH,a.x/l.scaleW,1-a.y/l.scaleH,(a.x+a.width)/l.scaleW,1-a.y/l.scaleH,(a.x+a.width)/l.scaleW,1-(a.y+a.height)/l.scaleH];for(var b=this.currentVbb.vcount,x=y.length/2,k=0;k<x;k++)this.currentVbb.addVertexMSDFPolytriangle(v[2*k],v[2*k+1],m[2*k],m[2*k+1],this.getFillColor(),this.dbId,this.currentLayerId,0);return this.currentVbb.addIndices([0,2,1,0,2,3],b),this.currentImage=this.fontAtlas.pages[a.page],!0}return!1}},{key:"beginPath",value:function(e,t,i,n,o){this.updateDBId(),"string"==typeof e&&n&&o?this.fontAtlas&&this.drawMSDFText(e,t,i,n,o)?this.skipPath=!0:(this._beginTextChar(e,t,i,n,o),this.skipPath=!1):(this.skipPath=!1,this.isFontChar=!1),this.skipPath?this._curPath=null:this._curPath=new h(this.isFontChar?1e-4:this.precisionTolerance)}},{key:"closePath",value:function(){this.skipPath||this._curPath.closePath()}},{key:"moveTo",value:function(e,t){if(!this.skipPath){this._curPath||this.beginPath();var i=this.getCurrentTransform();this._curPath.moveTo(this.tx(e,t,i),this.ty(e,t,i))}}},{key:"lineTo",value:function(e,t){if(!this.skipPath){var i=this.getCurrentTransform();this._curPath.lineTo(this.tx(e,t,i),this.ty(e,t,i))}}},{key:"arc",value:function(e,t,i,n,o,r){this.skipPath||this._curPath.arc(e,t,i,n,o,r)}},{key:"arcTo",value:function(e,t,i,n,o){if(!this.skipPath){var r=this.getCurrentTransform();this._curPath.arcTo(this.tx(e,t,r),this.ty(e,t,r),this.tx(i,n,r),this.ty(i,n,r),this.scaleValue(o,r))}}},{key:"quadraticCurveTo",value:function(e,t,i,n){if(!this.skipPath){var o=this.getCurrentTransform();this._curPath.quadraticCurveTo(this.tx(e,t,o),this.ty(e,t,o),this.tx(i,n,o),this.ty(i,n,o))}}},{key:"bezierCurveTo",value:function(e,t,i,n,o,r){if(!this.skipPath){var s=this.getCurrentTransform();this._curPath.bezierCurveTo(this.tx(e,t,s),this.ty(e,t,s),this.tx(i,n,s),this.ty(i,n,s),this.tx(o,r,s),this.ty(o,r,s))}}},{key:"rect",value:function(e,t,i,n){if(!this.skipPath){var o=this.getCurrentTransform();this._curPath||this.beginPath(),this._curPath.moveTo(this.tx(e,t,o),this.ty(e,t,o)),this._curPath.lineTo(this.tx(e+i,t,o),this.ty(e+i,t,o)),this._curPath.lineTo(this.tx(e+i,t+n,o),this.ty(e+i,t+n,o)),this._curPath.lineTo(this.tx(e+i,t,o),this.ty(e+i,t,o)),this._curPath.closePath()}}},{key:"fill",value:function(){this.isFontChar&&!this.cachedGlyph&&(this.glyphCache[this.hashKey]=this._curPath,this.cachedGlyph=this._curPath,this.cachedGlyph.cacheTriangulation()),this.isFontChar=!1,this.cachedGlyph?this.cachedGlyph.fill(this,this.getFillColor(),this.dbId,this.currentLayerId,this._curClip,!0):this._curPath&&this._curPath.fill(this,this.getFillColor(),this.dbId,this.currentLayerId,this._curClip,!1),this.cachedGlyph=null,this.skipPath=!1}},{key:"stroke",value:function(){this.isFontChar&&!this.cachedGlyph&&(this.glyphCache[this.hashKey]=this._curPath,this.cachedGlyph=this._curPath,this.cachedGlyph.cacheTriangulation()),this.isFontChar=!1;var e=this.isScreenSpace?-1:1;this.cachedGlyph?this.cachedGlyph.stroke(this,e*this.scaleValue(this.canvasContext.lineWidth),this.getStrokeColor(),this.dbId,this.currentLayerId,this._curClip,!0,this.lineStyle):this._curPath&&this._curPath.stroke(this,e*this.scaleValue(this.canvasContext.lineWidth),this.getStrokeColor(),this.dbId,this.currentLayerId,this._curClip,!1,this.lineStyle),this.cachedGlyph=null,this.skipPath=!1}},{key:"clip",value:function(e,t){void 0!==t&&void 0!==e?(this._curClip=e,console.log("Probably unsupported use case")):(this._curClip?this._curClip=this._curClip.clip(this._curPath,e):this._curClip=this._curPath,this._curPath=null)}},{key:"strokeText",value:function(e,t,i,n,o,r){var s=this.canvasContext;s.save(),s.translate(t,i),this.fontEngine.drawText(this,e,0,0,o,r),this.stroke(),s.restore()}},{key:"fillText",value:function(e,t,i,n,o,r){var s=this.canvasContext;s.save(),s.translate(t,i),this.fontEngine.drawText(this,e,0,0,o,r),this.fill(),s.restore()}},{key:"drawImage",value:function(e,t,i,n,o,r,s,a,l){if(0!==e.width&&0!==e.height)if(void 0===r&&(r=t,s=i,a=n,l=o),void 0===a&&(a=e.width,l=e.height),a){var h=this.getCurrentTransform(),u=this.tx(r+a/2,s+l/2),c=this.ty(r+a/2,s+l/2);T.elements[0]=h[0],T.elements[1]=h[1],T.elements[4]=h[2],T.elements[5]=h[3],T.elements[12]=h[4],T.elements[13]=h[5],T.decompose(S,E,w);var p=a*w.x*this.toPageUnits,d=-l*w.y*this.toPageUnits,f=Math.sqrt(1-E.w*E.w);P.set(E.x/f,E.y/f,E.z/f);var y=2*Math.acos(Math.max(Math.min(1,E.w),-1));E.z<0&&(y=-y),y<0&&(y+=2*Math.PI),this.flushBuffer(0,!0),this.currentVbb.addTexturedQuad(u,c,p,d,y,4294902015,0,this.currentLayerId,0),this.currentImage=e,this.flushBuffer(0,!0,!1)}else console.warn("Zero size image, skipping");else console.warn("Zero size image, skipping")}},{key:"beginMarkedContent",value:function(e){isNaN(e)?this.taggedId=null:this.taggedId=parseInt(e),this.ocgStack.push({tag:this.taggedId,isMarkedContent:!0})}},{key:"beginMarkedContentProps",value:function(e,t){if("OC"===e){var i=this.layers[t];null==i&&(i=this.defaultLayerId),this.currentLayerId=i,this.ocgStack.push({layerId:this.currentLayerId,isMarkedContentProps:!0})}}},{key:"endMarkedContent",value:function(){if(this.ocgStack.pop(),this.ocgStack.length>0){var e=this.ocgStack[this.ocgStack.length-1];e.isMarkedContent?this.taggedId=e.tag:e.isMarkedContentProps&&(this.currentLayerId=this.currentLayerId)}else this.currentLayerId=this.defaultLayerId,this.taggedId=null}},{key:"finish",value:function(){this.flushBuffer(0,!0),this.fontAtlas=null}}])&&v(t.prototype,i),o&&v(t,o),e}()},2:function(e,t,i){var n,o,r={},s=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=n.apply(this,arguments)),o}),a=function(e,t){return t?t.querySelector(e):document.querySelector(e)},l=function(e){var t={};return function(e,i){if("function"==typeof e)return e();if(void 0===t[e]){var n=a.call(this,e,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),h=null,u=0,c=[],p=i(3);function d(e,t){for(var i=0;i<e.length;i++){var n=e[i],o=r[n.id];if(o){o.refs++;for(var s=0;s<o.parts.length;s++)o.parts[s](n.parts[s]);for(;s<n.parts.length;s++)o.parts.push(b(n.parts[s],t))}else{var a=[];for(s=0;s<n.parts.length;s++)a.push(b(n.parts[s],t));r[n.id]={id:n.id,refs:1,parts:a}}}}function f(e,t){for(var i=[],n={},o=0;o<e.length;o++){var r=e[o],s=t.base?r[0]+t.base:r[0],a={css:r[1],media:r[2],sourceMap:r[3]};n[s]?n[s].parts.push(a):i.push(n[s]={id:s,parts:[a]})}return i}function y(e,t){var i=l(e.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=c[c.length-1];if("top"===e.insertAt)n?n.nextSibling?i.insertBefore(t,n.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),c.push(t);else if("bottom"===e.insertAt)i.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=l(e.insertAt.before,i);i.insertBefore(t,o)}}function v(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=c.indexOf(e);t>=0&&c.splice(t,1)}function g(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var n=function(){0;return i.nc}();n&&(e.attrs.nonce=n)}return m(t,e.attrs),y(e,t),t}function m(e,t){Object.keys(t).forEach((function(i){e.setAttribute(i,t[i])}))}function b(e,t){var i,n,o,r;if(t.transform&&e.css){if(!(r="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=r}if(t.singleton){var s=u++;i=h||(h=g(t)),n=S.bind(null,i,s,!1),o=S.bind(null,i,s,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),y(e,t),t}(t),n=w.bind(null,i,t),o=function(){v(i),i.href&&URL.revokeObjectURL(i.href)}):(i=g(t),n=E.bind(null,i),o=function(){v(i)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var i=f(e,t);return d(i,t),function(e){for(var n=[],o=0;o<i.length;o++){var s=i[o];(a=r[s.id]).refs--,n.push(a)}e&&d(f(e,t),t);for(o=0;o<n.length;o++){var a;if(0===(a=n[o]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete r[a.id]}}}};var x,k=(x=[],function(e,t){return x[e]=t,x.filter(Boolean).join("\n")});function S(e,t,i,n){var o=i?"":n.css;if(e.styleSheet)e.styleSheet.cssText=k(t,o);else{var r=document.createTextNode(o),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(r,s[t]):e.appendChild(r)}}function E(e,t){var i=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}function w(e,t,i){var n=i.css,o=i.sourceMap,r=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||r)&&(n=p(n)),o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var s=new Blob([n],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}},248:function(e,t,i){var n=i(249);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(2)(n,o);n.locals&&(e.exports=n.locals)},249:function(e,t,i){(e.exports=i(1)(!1)).push([e.i,".adsk-viewing-viewer .edge-gizmo:hover{background-color:lime}.adsk-viewing-viewer .edge-gizmo{position:absolute;background-color:#009bff;box-shadow:0px 1px 3px 1px rgba(0,0,0,0.25);border-radius:8px;cursor:move;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0)}.adsk-viewing-viewer .edge-gizmo.selected{background-color:lime}.adsk-viewing-viewer .vertex-gizmo:hover.vertex-gizmo.enable-hover{border-color:lime}.adsk-viewing-viewer .vertex-gizmo{display:inline-block;position:absolute;width:7px;height:7px;left:-2px;top:-2px;background-color:#009bff;border-style:solid;border-width:2px;border-color:#FFFFFF;border-radius:100px;box-shadow:0 2px 5px 0 #182A3D;z-index:2;cursor:move}.adsk-viewing-viewer .vertex-gizmo.selected{border-color:lime}.adsk-viewing-viewer .edge-move-gizmo{width:20px;height:6px}\n",""])},3:function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var i=t.protocol+"//"+t.host,n=i+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,r=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?e:(o=0===r.indexOf("//")?r:0===r.indexOf("/")?i+r:n+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},436:function(e,t,i){"use strict";i.r(t);var n=i(18);i(6);function o(e){e.mozCurrentTransform||(e._originalSave=e.save,e._originalRestore=e.restore,e._originalRotate=e.rotate,e._originalScale=e.scale,e._originalTranslate=e.translate,e._originalTransform=e.transform,e._originalSetTransform=e.setTransform,e._transformMatrix=e._transformMatrix||[1,0,0,1,0,0],e._transformStack=[],Object.defineProperty(e,"mozCurrentTransform",{get:function(){return this._transformMatrix}}),Object.defineProperty(e,"mozCurrentTransformInverse",{get:function(){var e=this._transformMatrix,t=e[0],i=e[1],n=e[2],o=e[3],r=e[4],s=e[5],a=t*o-i*n,l=i*n-t*o;return[o/a,i/l,n/l,t/a,(o*r-n*s)/l,(i*r-t*s)/a]}}),e.save=function(){var e=this._transformMatrix;this._transformStack.push(e),this._transformMatrix=e.slice(0,6),this._originalSave()},e.restore=function(){var e=this._transformStack.pop();e&&(this._transformMatrix=e,this._originalRestore())},e.translate=function(e,t){var i=this._transformMatrix;i[4]=i[0]*e+i[2]*t+i[4],i[5]=i[1]*e+i[3]*t+i[5],this._originalTranslate(e,t)},e.scale=function(e,t){var i=this._transformMatrix;i[0]=i[0]*e,i[1]=i[1]*e,i[2]=i[2]*t,i[3]=i[3]*t,this._originalScale(e,t)},e.transform=function(t,i,n,o,r,s){var a=this._transformMatrix;this._transformMatrix=[a[0]*t+a[2]*i,a[1]*t+a[3]*i,a[0]*n+a[2]*o,a[1]*n+a[3]*o,a[0]*r+a[2]*s+a[4],a[1]*r+a[3]*s+a[5]],e._originalTransform(t,i,n,o,r,s)},e.setTransform=function(t,i,n,o,r,s){this._transformMatrix=[t,i,n,o,r,s],e._originalSetTransform(t,i,n,o,r,s)},e.rotate=function(e){var t=Math.cos(e),i=Math.sin(e),n=this._transformMatrix;this._transformMatrix=[n[0]*t+n[2]*i,n[1]*t+n[3]*i,n[0]*-i+n[2]*t,n[1]*-i+n[3]*t,n[4],n[5]],this._originalRotate(e)})}function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s,a=1,l=function(){function e(t,i,r){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=new THREE.Scene,this.shapes=[],this.canvasGizmos=[],this.id=a++;this.viewport={width:t,height:i};this.context=new n.a(this.viewport,1,this._processMesh.bind(this),null),this.viewer=r,this.autoUpdate=!0,this.toPageUnits=1,this.styleModifiers=[],o(this.context.canvasContext),this.onCameraChange=function(){return s.updateCanvasGizmos()},this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange)}var t,i,s;return t=e,(i=[{key:"dtor",value:function(){this._clearScene(),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange)}},{key:"addShape",value:function(e){this.shapes.push(e),this._onModified()}},{key:"removeShape",value:function(e){var t=this.shapes.indexOf(e);return-1!==t&&(this.shapes.splice(t,1),this._onModified(),!0)}},{key:"clear",value:function(){this.shapes.length=0,this._onModified()}},{key:"update",value:function(){this._clearScene();for(var e=0;e<this.shapes.length;e++){var t=this.shapes[e],i=this._getOverrideStyle(t);t.draw(this.context,i)}this.context.flushBuffer(0,!0),this.viewer.impl.invalidate(!1,!1,!0),this.updateCanvasGizmos()}},{key:"updateCanvasGizmos",value:function(){for(var e=0;e<this.canvasGizmos.length;e++)this.canvasGizmos[e].update()}},{key:"addCanvasGizmo",value:function(e){this.canvasGizmos.push(e)}},{key:"removeCanvasGizmo",value:function(e){var t=this.canvasGizmos.indexOf(e);return-1!==t&&(this.canvasGizmos.splice(t,1),!0)}},{key:"getViewport",value:function(){return this.viewport}},{key:"hitTest",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=this.shapes.length-1;n>=0;n--){var o=this.shapes[n],r=this.getLineHitRadius(o,i);if(o.hitTest(e,t,r))return o}}},{key:"getLineHitRadius",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=this.getUnitsPerPixel(),n=(e.style.isScreenSpace?i:1)*e.style.lineWidth;return Math.max(n,t*i)}},{key:"addStyleModifier",value:function(e){this.styleModifiers.push(e),this._onModified()}},{key:"removeStyleModifier",value:function(e){var t=this.styleModifiers.indexOf(e);return-1!=t&&(this.styleModifiers.splice(t,1),this._onModified(),!0)}},{key:"layerToCanvas",value:function(e,t){var i=this.viewer.impl.worldToClient(new THREE.Vector3(e,t,0));return new THREE.Vector2(i.x,i.y)}},{key:"getPixelsPerUnit",value:function(){if(!this.viewer.model)return console.warn("Accessing EditLayer.getPixelsPerUnit is impossible when no model is loaded."),1;var e=this.viewer.impl.camera,t=this.viewer.impl.getVisibleBounds();return this.viewer.impl.getPixelsPerUnit(e,t)/window.devicePixelRatio}},{key:"getUnitsPerPixel",value:function(){return 1/this.getPixelsPerUnit()}},{key:"canvasToLayer",value:function(e,t){var i=this.viewer.impl.intersectGround(e,t);return new THREE.Vector2(i.x,i.y)}},{key:"enumShapes",value:function(e,t){for(var i=0;i<this.shapes.length;i++){var n=this.shapes[i];n.updateBBox(),e.isIntersectionBox(n.bbox)&&t(n)}}},{key:"enumMeshes",value:function(e,t){for(var i=0;i<this.scene.children.length;i++){var n=this.scene.children[i],o=n.geometry.boundingBox;e.isIntersectionBox(o)&&t(n)}}},{key:"findShapeById",value:function(e){return this.shapes.find((function(t){return t.id==e}))}},{key:"_processMesh",value:function(e){var t={mesh:e,is2d:!0,packId:"0",meshIndex:0};Autodesk.Viewing.Private.BufferGeometryUtils.meshToGeometry(t);var i=t.geometry,n=this.viewer.impl.getMaterials(),o=n.create2DMaterial(null,e.material),r=n.findMaterial(null,o),s=new THREE.Mesh(i,r);this.scene.children.push(s)}},{key:"_onModified",value:function(){this.autoUpdate&&this.update()}},{key:"_getOverrideStyle",value:function(e){for(var t=e.style,i=0;i<this.styleModifiers.length;i++)t=(0,this.styleModifiers[i])(e,t)||t;return t}},{key:"_clearScene",value:function(){for(var e=this.scene.children,t=0;t<e.length;t++)e[t].geometry.dispose();this.scene.children.length=0}}])&&r(t.prototype,i),s&&r(t,s),e}(),h=function(e,t,i){var n=(e.x-t.x)*i.x+(e.y-t.y)*i.y;e.set(t.x+n*i.x,t.y+n*i.y)},u=(s=new THREE.Vector2,function(e,t,i){return h(s.copy(e),t,i),e.distanceTo(s)}),c={getEdgeDirection:function(e,t,i){return(i=i||new THREE.Vector2).copy(t).sub(e).normalize()},projectToLine:h,pointLineDistance:u,intersectLines:function(e,t,i,n,o){var r=n.y*t.x-n.x*t.y;if(Math.abs(r)<1e-8)return!1;var s=e.x-i.x,a=e.y-i.y,l=n.x*a-n.y*s;return o&&(o.x=e.x+l/r*t.x,o.y=e.y+l/r*t.y),!0},rotateAround:function(e,t,i){var n=Math.cos(t),o=Math.sin(t);i&&e.sub(i);var r=e.x,s=e.y;return e.x=r*n-s*o,e.y=r*o+s*n,i&&e.add(i),e},angleBetweenDirections:function(e,t){var i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);return i<0&&(i+=2*Math.PI),i},getEdgeCenter:function(e,t,i){return(i=i||new THREE.Vector2).set(.5*(e.x+t.x),.5*(e.y+t.y))},getEdgeLength:function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},turnLeft:function(e){var t=e.x;return e.x=-e.y,e.y=t,e},isPointOnEdge:function(e,t,i,n){var o=i.x-t.x,r=i.y-t.y,s=Math.sqrt(o*o+r*r),a={v1:t,dx:o,dy:r,length:s,length2:s*s};return Autodesk.Extensions.CompGeom.pointOnLine(e.x,e.y,a,!0,n)},edgeIsDegenerated:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-10;return e.distanceToSquared(t)<i}};function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?f(e):t}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t,i){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function k(e,t,i){return t&&x(e.prototype,t),i&&x(e,i),e}var S=1,E=function(e,t,i){return"rgb("+e+","+t+","+i+")"},w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b(this,e),this.lineColor=t.lineColor||t.color||"rgb(0,0,64)",this.lineAlpha=void 0!==t.lineAlpha?t.lineAlpha:void 0!==t.alpha?t.alpha:1,this.lineWidth=void 0!==t.lineWidth?t.lineWidth:3,this.fillColor=t.fillColor||t.color||"rgb(0,0,64)",this.fillAlpha=void 0!==t.fillAlpha?t.fillAlpha:void 0!==t.alpha?t.alpha:.2,this.lineStyle=t.lineStyle||0,this.isScreenSpace=void 0===t.isScreenSpace||t.isScreenSpace}return k(e,[{key:"setFillColor",value:function(e,t,i){this.fillColor=E(e,t,i)}},{key:"setLineColor",value:function(e,t,i){this.lineColor=E(e,t,i)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.lineColor=e.lineColor,this.lineAlpha=e.lineAlpha,this.lineWidth=e.lineWidth,this.fillColor=e.fillColor,this.fillAlpha=e.fillAlpha,this.lineStyle=e.lineStyle,this.isScreenSpace=e.isScreenSpace,this}}]),e}();w.toColor=E;var P=new w,T=function(e,t){t.makeEmpty();for(var i=0;i<e.length;i++)t.expandByPoint(e[i])},C=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P.clone();b(this,e),this.style=t,this.id=S++,this.bbox=new THREE.Box2,this.bboxDirty=!0,this.name=this.id.toString()}return k(e,[{key:"draw",value:function(){}},{key:"hitTest",value:function(){}},{key:"move",value:function(){return this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.style=e.style.clone(),this}},{key:"computeBBox",value:function(){console.error("Must be implemented by derived class.")}},{key:"modified",value:function(){this.bboxDirty=!0}},{key:"updateBBox",value:function(){this.bboxDirty&&(this.computeBBox(),this.bboxDirty=!1)}}]),e}(),A=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.clone();return b(this,t),(e=d(this,v(t).call(this,n))).points=i,e}return g(t,e),k(t,[{key:"isPolygon",value:function(){return this instanceof _}},{key:"isPolyline",value:function(){return this instanceof L}},{key:"addPoint",value:function(e,t){this.points.push({x:e,y:t}),this.modified()}},{key:"getPoint",value:function(e,t){return(t=t||new THREE.Vector2).copy(this.points[e])}},{key:"removePoint",value:function(e){this.points.splice(e,1)}},{key:"updatePoint",value:function(e,t,i){var n=this.points[e];n.x=t,n.y=i,this.modified()}},{key:"insertPoint",value:function(e,t){this.points.splice(e,0,t)}},{key:"clear",value:function(){this.points.length=0,this.modified()}},{key:"enumEdges",value:function(e){for(var t=this.isPolygon()?this.length:this.length-1,i=0;i<t;i++){var n=i,o=(i+1)%this.length;if(e(this.getPoint(n),this.getPoint(o),n,o))return}}},{key:"findEdgeIndex",value:function(e,t){var i=-1;return this.enumEdges((function(n,o,r){var s=c.isPointOnEdge(e,n,o,t);return s&&(i=r),s})),i}},{key:"move",value:function(e,t){for(var i=0;i<this.points.length;i++)this.points[i].x+=e,this.points[i].y+=t;return this.modified(),this}},{key:"copy",value:function(e){return y(v(t.prototype),"copy",this).call(this,e),this.points=e.points.map((function(e){return{x:e.x,y:e.y}})),this.modified(),this}},{key:"computeBBox",value:function(){T(this.points,this.bbox)}},{key:"nextIndex",value:function(e){return(e+1)%this.length}},{key:"prevIndex",value:function(e){return(e+this.length-1)%this.length}},{key:"edgeIndexValid",value:function(e){var t=this.getEdgeCount();return e>=0&&e<t}},{key:"getEdge",value:function(e,t,i){var n=e,o=this.nextIndex(e);this.getPoint(n,t),this.getPoint(o,i)}},{key:"getEdgeCount",value:function(){return this.isPolygon()?this.length:this.length-1}},{key:"length",get:function(){return this.points.length}}]),t}(C),_=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.clone();return b(this,t),d(this,v(t).call(this,e,i))}return g(t,e),k(t,[{key:"draw",value:function(e,t){if(this.length){var i=t||this.style;e.dbId=this.id,e.lineStyle=i.lineStyle,e.isScreenSpace=i.isScreenSpace,e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n+=1)e.lineTo(this.points[n].x,this.points[n].y);e.closePath();var o=e.canvasContext;o.fillStyle=i.fillColor,o.globalAlpha=i.fillAlpha,e.fill(),o.strokeStyle=i.lineColor,o.globalAlpha=i.lineAlpha,o.lineWidth=i.lineWidth,i.isScreenSpace&&(o.lineWidth*=window.devicePixelRatio),e.stroke(),e.dbId=-1,e.lineStyle=0,e.isScreenSpace=!1}}},{key:"hitTest",value:function(e,t){for(var i=new Autodesk.Extensions.CompGeom.ComplexPolygon(this.points),n=[],o=0;o<this.length;o++)n.push(o);return i.pointInContour(e,t,n)}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"getArea",value:function(){return Math.abs(Autodesk.Viewing.Extensions.CompGeom.polygonArea(this.points))}}]),t}(A),L=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.clone();return b(this,t),d(this,v(t).call(this,e,i))}return g(t,e),k(t,[{key:"makeLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return 2!=this.length?(this.clear(),this.addPoint(e,t),this.addPoint(i,n)):(this.updatePoint(0,e,t),this.updatePoint(1,i,n)),this}},{key:"draw",value:function(e,t){if(this.length){var i=t||this.style;e.dbId=this.id,e.lineStyle=i.lineStyle,e.isScreenSpace=i.isScreenSpace,e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n++)e.lineTo(this.points[n].x,this.points[n].y);var o=e.canvasContext;o.strokeStyle=i.lineColor,o.globalAlpha=i.lineAlpha,o.lineWidth=i.lineWidth,i.isScreenSpace&&(o.lineWidth*=window.devicePixelRatio),e.stroke(),e.dbId=-1,e.lineStyle=0,e.isScreenSpace=!1}}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"computeBBox",value:function(){T(this.points,this.bbox)}},{key:"hitTest",value:function(e,t,i){return-1!=this.findEdgeIndex({x:e,y:t},i)}},{key:"getLength",value:function(){for(var e=0,t=0;t<this.points.length-1;t++){var i=this.points[t],n=this.points[t+1];e+=c.getEdgeLength(i,n)}return e}}]),t}(A),V=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P.clone(),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;return b(this,t),(e=d(this,v(t).call(this,r))).polygon=new _([],r),e.polygon.id=e.id,e.centerX=i,e.centerY=n,e.radius=o,e.tessSegments=s,e.needsUpdate=!0,e}return g(t,e),k(t,[{key:"draw",value:function(e,t){this.polygon.points.length=0;for(var i=360/this.tessSegments,n=0;n<360;n+=i){var o=n*Math.PI/180,r=this.radius*Math.cos(o),s=this.radius*Math.sin(o);this.polygon.addPoint(this.centerX+r,this.centerY+s)}this.needsUpdate=!1,this.polygon.draw(e,t)}},{key:"setCenter",value:function(e,t){this.centerX=e,this.centerY=t,this.modified()}},{key:"move",value:function(e,t){this.centerX+=e,this.centerY+=t,this.modified()}},{key:"hitTest",value:function(e,t){var i=e-this.centerX,n=t-this.centerY;return i*i+n*n<this.radius*this.radius}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"copy",value:function(e){return y(v(t.prototype),"copy",this).call(this,e),this.polygon=e.polygon.clone(),this.centerX=e.centerX,this.centerY=e.centerY,this.radius=e.radius,this.tessSegments=e.tessSegments,this.modified(),this}},{key:"computeBBox",value:function(){this.bbox.min.set(this.centerX-this.radius,this.centerY-this.radius),this.bbox.max.set(this.centerX+this.radius,this.centerY+this.radius)}}]),t}(C),z=function(e){function t(e){var i;return b(this,t),(i=d(this,v(t).call(this))).shape=e,Object.defineProperty(f(i),"bbox",{get:function(){return i.shape.bbox},set:function(e){i.shape.bbox=e}}),Object.defineProperty(f(i),"id",{get:function(){return i.shape.id},set:function(e){i.shape.id=e}}),Object.defineProperty(f(i),"bboxDirty",{get:function(){return i.shape.bboxDirty},set:function(e){i.shape.bboxDirty=e}}),Object.defineProperty(f(i),"name",{get:function(){return i.shape.name},set:function(e){i.shape.name=e}}),i}return g(t,e),k(t,[{key:"draw",value:function(){var e;return(e=this.shape).draw.apply(e,arguments)}},{key:"hitTest",value:function(){var e;return(e=this.shape).hitTest.apply(e,arguments)}},{key:"move",value:function(){var e;return(e=this.shape).move.apply(e,arguments)}},{key:"modified",value:function(){var e;return(e=this.shape).modified.apply(e,arguments)}},{key:"computeBBox",value:function(){var e;return(e=this.shape).computeBBox.apply(e,arguments)}},{key:"updateBBox",value:function(){var e;return(e=this.shape).updateBBox.apply(e,arguments)}},{key:"clone",value:function(){return new t(this.shape.clone())}},{key:"copy",value:function(e){this.shape.copy(e.shape)}}]),t}(C);function M(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var O=Autodesk.Viewing,D=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),O.EventDispatcher.prototype.apply(this),this.stack=[],this.current=0}var t,i,n;return t=e,(i=[{key:"run",value:function(t){this.stack.length=this.current,this.dispatchEvent({type:e.BEFORE_ACTION,action:t}),t.redo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t}),this.stack.push(t),this.current=this.stack.length}},{key:"undo",value:function(){if(!this.current)return!1;this.current--;var t=this.stack[this.current];return this.dispatchEvent({type:e.BEFORE_ACTION,action:t,isUndo:!0}),t.undo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t,isUndo:!0}),t.layer.update(),!0}},{key:"redo",value:function(){var t=this.stack[this.current];return!!t&&(this.dispatchEvent({type:e.BEFORE_ACTION,action:t,isUndo:!1}),t.redo(),this.dispatchEvent({type:e.AFTER_ACTION,action:t,isUndo:!1}),this.current++,t.layer.update(),!0)}},{key:"clear",value:function(){this.stack.length=0,this.current=0}}])&&M(t.prototype,i),n&&M(t,n),e}();function R(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}D.BEFORE_ACTION="beforeAction",D.AFTER_ACTION="afterAction";var I=Autodesk.Viewing,G=function(){function e(t,i){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),I.EventDispatcher.prototype.apply(this),this.isSelected={},this.tmpStyle=new w,this.modifier=function(e,t){if(n.isSelected[e.id])return n.tmpStyle.copy(t),n.tmpStyle.fillAlpha=Math.min(n.tmpStyle.fillAlpha+.3,1),n.tmpStyle.lineWidth*=1.5,n.tmpStyle},this.layer=t,this.layer.addStyleModifier(this.modifier),this.undoStack=i,this.onActionCb=function(e){return n.onAction(e)},this.undoStack.addEventListener(D.AFTER_ACTION,this.onActionCb)}var t,i,n;return t=e,(i=[{key:"dtor",value:function(){this.layer.removeStyleModifier(this.modifier),this.undoStack.removeEventListener(D.AFTER_ACTION,this.onActionCb)}},{key:"setSelection",value:function(e){e=e||[];var t=!1;if(this.getSelectedShapes().length!=e.length)t=!0;else for(var i=0;i<e.length;i++){var n=e[i];this.isSelected[n.id]||(t=!0)}if(t){this.isSelected={};for(var o=0;o<e.length;o++){var r=e[o];this.isSelected[r.id]=r}this.modified()}}},{key:"empty",value:function(){return!Object.keys(this.isSelected).length}},{key:"selectOnly",value:function(e){this.setSelection(e&&[e])}},{key:"clear",value:function(){this.setSelection([])}},{key:"getSelectedShapes",value:function(){return Object.values(this.isSelected)}},{key:"getSelectedIds",value:function(){return Object.keys(this.isSelected)}},{key:"modified",value:function(){this.layer.update(),this.dispatchEvent({type:e.Events.SELECTION_CHANGED})}},{key:"onAction",value:function(){if(!this.empty()){var e=this.getSelectedShapes();if(1!=e.length){var t={};this.layer.shapes.forEach((function(e){return t[e.id]=!0})),e=e.filter((function(e){return t[e.id]})),this.setSelection(e)}else this.layer.findShapeById(e[0].id)||this.clear()}}}])&&R(t.prototype,i),n&&R(t,n),e}();function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function K(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Y(e,t,i){return t&&K(e.prototype,t),i&&K(e,i),e}G.Events={SELECTION_CHANGED:"selectionChanged"};var W=function(){function e(t){F(this,e),this.layer=t}return Y(e,[{key:"undo",value:function(){throw new Error("Abstract method invoked")}},{key:"redo",value:function(){throw new Error("Abstract method invoked")}}]),e}(),X={Action:W,AddShape:function(e){function t(e,i){var n;return F(this,t),(n=j(this,H(t).call(this,e))).shape=i,n}return U(t,e),Y(t,[{key:"undo",value:function(){this.layer.removeShape(this.shape)}},{key:"redo",value:function(){this.layer.addShape(this.shape)}}]),t}(W),AddShapes:function(e){function t(e,i){var n;return F(this,t),(n=j(this,H(t).call(this,e))).shapes=i,n}return U(t,e),Y(t,[{key:"undo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.removeShape(t)}))}},{key:"redo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.addShape(t)}))}}]),t}(W),MoveShape:function(e){function t(e,i,n,o){var r;return F(this,t),(r=j(this,H(t).call(this,e))).shape=i,r.delta={x:n,y:o},r.beforeState=r.shape.clone(),r.afterState=r.shape.clone(),r.afterState.move(n,o),r}return U(t,e),Y(t,[{key:"undo",value:function(){this.shape.copy(this.beforeState)}},{key:"redo",value:function(){this.shape.copy(this.afterState)}}]),t}(W),RemoveShape:function(e){function t(e,i){var n;return F(this,t),(n=j(this,H(t).call(this,e))).shape=i,n}return U(t,e),Y(t,[{key:"undo",value:function(){this.layer.addShape(this.shape)}},{key:"redo",value:function(){this.layer.removeShape(this.shape)}}]),t}(W),RemoveShapes:function(e){function t(e,i){var n;return F(this,t),(n=j(this,H(t).call(this,e))).shapes=i,n}return U(t,e),Y(t,[{key:"undo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.addShape(t)}))}},{key:"redo",value:function(){var e=this;this.shapes.forEach((function(t){return e.layer.removeShape(t)}))}}]),t}(W),AddVertex:function(e){function t(e,i,n,o){var r;return F(this,t),(r=j(this,H(t).call(this,e))).poly=i,r.vIndex=n,r.point=o.clone(),r}return U(t,e),Y(t,[{key:"undo",value:function(){this.poly.removePoint(this.vIndex)}},{key:"redo",value:function(){this.poly.insertPoint(this.vIndex,this.point)}}]),t}(W),MoveVertex:function(e){function t(e,i,n,o){var r;return F(this,t),(r=j(this,H(t).call(this,e))).poly=i,r.vIndex=n,r.posBefore=i.getPoint(n),r.posAfter=o.clone(),r}return U(t,e),Y(t,[{key:"undo",value:function(){this.poly.updatePoint(this.vIndex,this.posBefore.x,this.posBefore.y)}},{key:"redo",value:function(){this.poly.updatePoint(this.vIndex,this.posAfter.x,this.posAfter.y)}}]),t}(W),RemoveVertex:function(e){function t(e,i,n){var o;return F(this,t),(o=j(this,H(t).call(this,e))).poly=i,o.vIndex=n,o.point=i.getPoint(n),o}return U(t,e),Y(t,[{key:"undo",value:function(){this.poly.insertPoint(this.vIndex,this.point)}},{key:"redo",value:function(){this.poly.removePoint(this.vIndex)}}]),t}(W),MoveEdge:function(e){function t(e,i,n,o,r){var s;F(this,t),(s=j(this,H(t).call(this,e))).poly=i,s.ia=n,s.ib=(n+1)%i.length;var a=i.getPoint(s.ia),l=i.getPoint(s.ib);return s.edgeBefore={a:a,b:l},s.edgeAfter={a:o.clone(),b:r.clone()},s}return U(t,e),Y(t,[{key:"undo",value:function(){this.poly.updatePoint(this.ia,this.edgeBefore.a.x,this.edgeBefore.a.y),this.poly.updatePoint(this.ib,this.edgeBefore.b.x,this.edgeBefore.b.y)}},{key:"redo",value:function(){this.poly.updatePoint(this.ia,this.edgeAfter.a.x,this.edgeAfter.a.y),this.poly.updatePoint(this.ib,this.edgeAfter.b.x,this.edgeAfter.b.y)}}]),t}(W)};function q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $(e,t,i){return t&&Q(e.prototype,t),i&&Q(e,i),e}var J=function(){function e(t,i){q(this,e),this.a=t.clone(),this.b=i.clone(),this.dir=c.getEdgeDirection(t,i)}return $(e,[{key:"intersect",value:function(e,t){return c.intersectLines(this.a,this.dir,e.a,e.dir,t)}},{key:"snapToLine",value:function(e){c.projectToLine(e,this.a,this.dir)}},{key:"isUsable",value:function(e,t){return c.pointLineDistance(e,this.a,this.dir)<t}}]),e}(),Z=function(e,t,i){t&&(i?t.intersect(i,e):t.snapToLine(e))},ee=function(e,t){return t=(t+e.length)%e.length,e.getPoint(t)},te=function(e,t){var i=new THREE.Vector2,n=new THREE.Vector2,o=new THREE.Vector2,r=[];return e.enumEdges((function(e,s,a,l){a!=t&&l!=t&&(c.edgeIsDegenerated(e,s)||function(e,t){r.push(new J(e,t)),i=c.turnLeft(c.getEdgeDirection(e,t,i)),n=c.getEdgeCenter(e,t,n),o.copy(e).add(i),r.push(new J(e,o)),o.copy(n).add(i),r.push(new J(n,o)),o.copy(t).add(i),r.push(new J(t,o))}(e,s))})),r},ie=function(e,t,i,n,o){var r=new THREE.Vector2;return i.intersect(e,r)?r.distanceTo(n)>o?t:t?Math.abs(i.dir.dot(e.dir))>Math.abs(i.dir.dot(t.dir))?e:t:e:t},ne=new THREE.Vector2(1,0),oe=function(){function e(t){q(this,e),this.poly=null,this.vIndex=-1,this.snapAngles=[0,45,90,135,180,225,270,315,360],this.snapAngleTolerance=2,this.snapRadius=10,this.gizmoLayer=t,this.movedPoint=new THREE.Vector2,this.prevPoint=new THREE.Vector2,this.prevPoint2=new THREE.Vector2,this.edgeDir=new THREE.Vector2,this.alignAxis=new THREE.Vector2,this.edgeSnapLines=[],this.snapLine1=null,this.snapLine2=null,this.snapLineStyle=new w({lineColor:"rgb(255, 0, 0)",lineWidth:1,lineStyle:10}),this.snapLineGizmo1=new L([],this.snapLineStyle),this.snapLineGizmo2=new L([],this.snapLineStyle)}return $(e,[{key:"startSnapping",value:function(e,t){this.poly=e,this.vIndex=t,this.edgeSnapLines=te(e,t)}},{key:"stopSnapping",value:function(){this.poly=null,this.vIndex=-1,this.snapLine1=null,this.snapLine2=null,this.clearSnappingGizmos()}},{key:"clearSnappingGizmos",value:function(){this.gizmoLayer.removeShape(this.snapLineGizmo1),this.gizmoLayer.removeShape(this.snapLineGizmo2)}},{key:"clearSnappingResult",value:function(){this.snapLine1=null,this.snapLine2=null}},{key:"snapToAngle",value:function(e){if(this.snapLine1=null,this.snapLine2=null,this.active&&!(this.poly.length<=1)){var t=ee(this.poly,this.vIndex-1);if(2==this.poly.length)return this.snapLine1=this.computeAngleSnapLine(e,t,ne),void Z(e,this.snapLine1);var i=ee(this.poly,this.vIndex-2),n=ee(this.poly,this.vIndex+1),o=ee(this.poly,this.vIndex+2),r=this.poly.isPolyline()&&this.vIndex>=this.poly.length-2,s=c.getEdgeDirection(i,t),a=this.computeAngleSnapLine(e,t,s),l=null;r||(s=c.getEdgeDirection(n,o,s),l=this.computeAngleSnapLine(e,n,s));var h=this.snapRadius*this.gizmoLayer.getUnitsPerPixel(),u=this.edgeSnapLines.filter((function(t){return t.isUsable(e,h)}));if(this.snapLine1=a||l||u[0],this.snapLine1){if(a&&l&&(this.snapLine2=ie(l,null,this.snapLine1,e,h)),!this.snapLine2)for(var p=0;p<u.length;p++){var d=u[p];this.snapLine2=ie(d,this.snapLine2,this.snapLine1,e,h)}return Z(e,this.snapLine1,this.snapLine2)}}}},{key:"updateSnapLineGizmos",value:function(e){var t=this;this.gizmoLayer.removeShape(this.snapLineGizmo1),this.gizmoLayer.removeShape(this.snapLineGizmo2);var i=this.gizmoLayer.viewport.width,n=this.gizmoLayer.viewport.height,o=Math.sqrt(i*i+n*n),r=function(e,i){if(e){var n=e.a;i.makeLine(n.x-o*e.dir.x,n.y-o*e.dir.y,n.x+o*e.dir.x,n.y+o*e.dir.y),t.gizmoLayer.addShape(i)}};r(this.snapLine1,this.snapLineGizmo1),r(this.snapLine2,this.snapLineGizmo2)}},{key:"dtor",value:function(){this.clearSnapping()}},{key:"computeAngleSnapLine",value:function(e,t,i){if(c.edgeIsDegenerated(t,e))return null;for(var n=e.clone().sub(t),o=THREE.Math.radToDeg(c.angleBetweenDirections(n,i)),r=-1,s=0;s<this.snapAngles.length;s++){var a=this.snapAngles[s];if(Math.abs(a-o)<this.snapAngleTolerance){r=s;break}}if(-1==r)return null;var l=THREE.Math.degToRad(this.snapAngles[r]),h=c.rotateAround(i.clone(),l),u=t.distanceTo(e),p=h.multiplyScalar(u).add(t);return new J(t,p)}},{key:"active",get:function(){return this.poly}}]),e}();function re(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function se(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ae(e,t,i){return t&&se(e.prototype,t),i&&se(e,i),e}var le={Line:1,CircularArc:2,EllipticalArc:3},he=function(e,t,i,n,o){return{type:le.Line,x1:e,y1:t,x2:i,y2:n,vpId:o}},ue=function(e,t,i,n,o,r){return{type:le.CirularArc,cx:e,cy:t,start:i,end:n,radius:o,vpId:r}},ce=function(e,t,i,n,o,r,s,a){return{type:le.EllipticalArc,cx:e,cy:t,start:i,end:n,major:o,minor:r,tilt:s,vpId:a}},pe=function(e,t){switch(e.type){case le.Line:t.onLineSegment(e.x1,e.y1,e.x2,e.y2,e.vpId);break;case le.CirularArc:t.onCircularArc(e.cx,e.cy,e.start,e.end,e.radius,e.vpId);break;case le.EllipticalArc:t.onEllipticalArc(e.cx,e.cy,e.tart,e.end,e.major,e.minor,e.tilt,e.vpId)}},de=function(){function e(){re(this,e),this.boundsCb=new Autodesk.Viewing.Private.BoundsCallback(new THREE.Box2),this.queryBox=new THREE.Box2,this.tmpPoint=new THREE.Vector2}return ae(e,[{key:"getSegmentBox",value:function(e){return this.boundsCb.bounds.makeEmpty(),pe(e,this.boundsCb),this.boundsCb.bounds}},{key:"getQueryBox",value:function(e,t,i,n){return this.queryBox.min.set(e,t),this.queryBox.max.set(i,n),this.queryBox}},{key:"intersectsBox",value:function(e,t,i,n,o){var r=this.getQueryBox(t,i,n,o),s=this.getSegmentBox(e);return r.isIntersectionBox(s)}},{key:"getPoint",value:function(e,t){var i=this.getSegmentBox(e).center(this.tmpPoint);t.x=i.x,t.y=i.y}}]),e}(),fe=function(){function e(t){re(this,e),this.useInstancing=t}return ae(e,[{key:"buildFromModel",value:function(e){var t=e.getBoundingBox();this.tree=new Autodesk.Extensions.CompGeom.QuadTree(t.min.x,t.min.y,t.max.x,t.max.y,0,new de);for(var i=e.getFragmentList(),n=i.getCount(),o=0;o<n;o++){var r=i.getGeometry(o);this.addGeometry(r)}}},{key:"addGeometry",value:function(e){var t=this,i={onLineSegment:function(){return t.tree.addItem(he.apply(void 0,arguments))},onCircularArc:function(){return t.tree.addItem(ue.apply(void 0,arguments))},onEllipticalArc:function(){return t.tree.addItem(ce.apply(void 0,arguments))}};new Autodesk.Viewing.Private.VertexBufferReader(e,this.use2dInstancing).enumGeoms(null,i)}},{key:"enumSegments",value:function(e,t,i,n,o){this.tree.enumInBox(e,t,i,n,(function(e){return pe(e,o)}))}}]),e}();function ye(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ve=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.layer=i,this.gizmoLayer=n,this.sheetSnapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(t),this.layerSnapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(t),this.angleSnapper=new oe(n),this.snapBox=new THREE.Box2,this.sheetSnapper.activate(),this.layerSnapper.activate(),this.onCameraChangeCb=this.onCameraChange.bind(this),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeCb),this.initSegmentTrees()}var t,i,n;return t=e,(i=[{key:"dtor",value:function(){this.sheetSnapper.deactivate(),this.layerSnapper.deactivate(),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeCb)}},{key:"onCameraChange",value:function(){this.updateSnapperIndicators()}},{key:"initSegmentTrees",value:function(){var e=this;this.viewer.getVisibleModels().forEach((function(t){t.is2d()&&!t.segmentTree&&(t.segmentTree=new fe(e.viewer.impl.use2dInstancing),t.segmentTree.buildFromModel(t))}))}},{key:"updateSnapperIndicators",value:function(){this.sheetSnapper.isSnapped()?this.sheetSnapper.indicator.render():this.layerSnapper.indicator.render()}},{key:"getSnapPosition",value:function(e,t,i){var n=this._getSnapPosition(e,t,i);return this.angleSnapper.updateSnapLineGizmos(n),this.updateSnapperIndicators(),n}},{key:"clearSnappingGizmos",value:function(){this.angleSnapper.clearSnappingGizmos(),this.sheetSnapper.clearSnapped(),this.sheetSnapper.indicator&&this.sheetSnapper.indicator.clearOverlays(),this.layerSnapper.clearSnapped(),this.layerSnapper.indicator&&this.layerSnapper.indicator.clearOverlays()}},{key:"startAngleSnapping",value:function(e,t){this.angleSnapper.startSnapping(e,t)}},{key:"stopAngleSnapping",value:function(){this.angleSnapper.stopSnapping()}},{key:"_getSnapPosition",value:function(e,t,i){this.angleSnapper.clearSnappingResult(),this.sheetSnapper.clearSnapped(),this.layerSnapper.clearSnapped();var n=this.layer.canvasToLayer(e,t),o=this._getGeomSnapPosition(e,t,i);return o||(this.angleSnapper.snapToAngle(n),n)}},{key:"_getGeomSnapPosition",value:function(e,t,i){var n=this.layer.canvasToLayer(e,t),o=this._getSheetSnapPosition(e,t),r=this._getEditLayerSnapPosition(e,t,i);return o||r?r?o?THREE.Vector2.prototype.distanceToSquared.call(o,n)<THREE.Vector2.prototype.distanceToSquared.call(r,n)?(this.layerSnapper.clearSnapped(),o):(this.sheetSnapper.clearSnapped(),r):r:o:null}},{key:"_getEditLayerSnapPosition",value:function(e,t,i){var n=this.viewer.impl.intersectGround(e,t),o=this.layerSnapper.setDetectRadius(n);this.snapBox.min.set(n.x-o,n.y-o),this.snapBox.max.set(n.x+o,n.y+o);var r={};this.layer.enumShapes(this.snapBox,(function(e){i&&!i(e)||(r[e.id]=!0)}));var s=[];if(this.layer.enumMeshes(this.snapBox,(function(e){return s.push(e)})),this.layerSnapper.clearSnapped(),this.layerSnapper.snapping2DOverlay(n,s,(function(e){return Boolean(r[e])}),!1),this.layerSnapper.isSnapped()){var a=this.layerSnapper.getSnapResult();return Autodesk.Viewing.MeasureCommon.getSnapResultPosition(a,this.viewer)}}},{key:"_getSheetSnapPosition",value:function(e,t){var i=this;this.initSegmentTrees();var n=this.viewer.impl.intersectGround(e,t);if(this.sheetSnapper.snapping2DWithSegmentEnum(n,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=i.viewer.getVisibleModels();o.forEach((function(e){var i;e.is2d()&&(i=e.segmentTree).enumSegments.apply(i,t)}))})),this.sheetSnapper.isSnapped()){var o=this.sheetSnapper.getSnapResult(),r=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(o,this.viewer);return(new THREE.Vector2).copy(r)}}}])&&ye(t.prototype,i),n&&ye(t,n),e}();function ge(e){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function me(e,t,i){return(me="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=xe(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function be(e,t){return!t||"object"!==ge(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xe(e){return(xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ke(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Se(e,t)}function Se(e,t){return(Se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function we(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pe(e,t,i){return t&&we(e.prototype,t),i&&we(e,i),e}var Te=Autodesk.Viewing.Private,Ce=function(){function e(){Ee(this,e)}return Pe(e,[{key:"lengthToString",value:function(e){console.error("Not implemented")}},{key:"areaToString",value:function(e){console.error("Not implemented")}}]),e}(),Ae=2,_e="inch",Le=function(e){function t(e){return Ee(this,t),be(this,xe(t).call(this,e))}return ke(t,e),Pe(t,[{key:"updateConfig",value:function(){var e=this.config,t=this.viewer.model;e.layerUnits=t?t.getUnitString():_e;var i=this.viewer.getExtension("Autodesk.Measure"),n=i&&i.sharedMeasureConfig;n?(e.displayUnits=n.units,e.precision=n.precision,e.scaleFactor=n.calibrationFactor):(e.displayUnits=this.config.layerUnits,e.precision=Ae,e.scaleFactor=1)}},{key:"lengthToString",value:function(e){return this.updateConfig(),me(xe(t.prototype),"lengthToString",this).call(this,e)}},{key:"areaToString",value:function(e){return this.updateConfig(),me(xe(t.prototype),"areaToString",this).call(this,e)}}]),t}(function(e){function t(e){var i;return Ee(this,t),(i=be(this,xe(t).call(this))).viewer=e,i.config={layerUnits:_e,displayUnits:_e,precision:Ae,scaleFactor:1},i}return ke(t,e),Pe(t,[{key:"lengthToString",value:function(e){var t=this.config;return e=Te.convertUnits(t.layerUnits,t.displayUnits,t.scaleFactor,e),Te.formatValueWithUnits(e,t.displayUnits,3,t.precision)}},{key:"areaToString",value:function(e){var t=this.config;return e=Te.convertUnits(t.layerUnits,t.displayUnits,t.scaleFactor,e,"square"),Te.formatValueWithUnits(e,t.displayUnits+"^2",3,t.precision)}}]),t}(Ce));function Ve(e){return(Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ze(e,t,i){return(ze="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=De(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function Me(e,t){return!t||"object"!==Ve(t)&&"function"!=typeof t?Oe(e):t}function Oe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Re(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ie(e,t)}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Be(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function je(e,t,i){return t&&Be(e.prototype,t),i&&Be(e,i),e}var He=function(e){return e.toString()+"px"},Ue={Left:1,Center:2,Right:3},Ne={Top:1,Center:2,Bottom:3},Fe=function(){function e(){Ge(this,e)}return je(e,[{key:"update",value:function(){}}]),e}(),Ke=function(e){function t(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Ge(this,t),(i=Me(this,De(t).call(this))).layer=e,i.layerPos=new THREE.Vector2,i.canvasPos=new THREE.Vector2,i.container=document.createElement("div"),i.container.style.position="absolute",i.container.style.transformOrigin="50% 50%",i.visible=!1,i.alignX=Ue.Center,i.alignY=Ne.Center,i.angle=0,n&&i.setVisible(!0,!1),i.isUnderMouse=!1,i.container.addEventListener("mouseenter",(function(){return i.isUnderMouse=!0})),i.container.addEventListener("mouseleave",(function(){return i.isUnderMouse=!1})),i}return Re(t,e),je(t,[{key:"dtor",value:function(){this.setVisible(!1)}},{key:"setVisible",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e!=this.visible&&(e?(this.layer.viewer.canvasWrap.appendChild(this.container),this.layer.addCanvasGizmo(this),t&&this.update()):(this.layer.viewer.canvasWrap.removeChild(this.container),this.layer.removeCanvasGizmo(this)),this.visible=e)}},{key:"setAlignX",value:function(e){this.alignX=e,this.update()}},{key:"setAlignY",value:function(e){this.alignY=e,this.update()}},{key:"setRotation",value:function(e){this.angle=e,this.update()}},{key:"update",value:function(){this.canvasPos.copy(this.layer.layerToCanvas(this.layerPos.x,this.layerPos.y));var e,t,i=this.canvasPos,n=this.container.style;switch(n.left=He(i.x),n.top=He(i.y),this.alignX){case Ue.Left:e="0%";break;case Ue.Center:e="-50%";break;case Ue.Right:e="-100%"}switch(this.alignY){case Ne.Top:t="0%";break;case Ne.Center:t="-50%";break;case Ne.Bottom:t="-100%"}n.transform="translate(".concat(e,", ").concat(t,") rotate(").concat(this.angle,"deg)")}},{key:"setPosition",value:function(e,t){this.layerPos.set(e,t),this.update()}},{key:"setClassEnabled",value:function(e,t){t?this.container.classList.add(e):this.container.classList.remove(e)}},{key:"setSelected",value:function(e){this.setClassEnabled("selected",e)}},{key:"isSelected",value:function(){return this.container.classList.contains("selected")}},{key:"setHoverEnabled",value:function(e){this.setClassEnabled("enable-hover",e)}},{key:"setName",value:function(e){this.name=e,this.container.id=e||""}}]),t}(Fe),Ye=function(e){e.container.classList.add("measure-length"),e.container.classList.add("visible"),e.textDiv=document.createElement("div"),e.textDiv.classList.add("measure-length-text"),e.container.appendChild(e.textDiv),e.setText=function(e){this.textDiv.textContent=e}.bind(e)},We=function(e){function t(e,i){var n,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Ge(this,t),n=Me(this,De(t).call(this,i,o)),Ye(Oe(n)),n.shape=e,n.valueValid=!0,n.update(),n}return Re(t,e),je(t,[{key:"update",value:function(){this.shape&&this.valueValid?(this.container.style.visibility="visible",this.shape.computeBBox(),this.shape.bbox.center(this.layerPos),ze(De(t.prototype),"update",this).call(this)):this.container.style.visibility="hidden"}},{key:"setShape",value:function(e){this.shape=e,this.update()}}]),t}(Ke),Xe=function(e){function t(e,i,n){var o,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Ge(this,t),(o=Me(this,De(t).call(this,e,i,r))).unitHandler=n,o}return Re(t,e),je(t,[{key:"update",value:function(){var e=this.shape&&this.shape.getArea&&this.shape.getArea();if(this.valueValid=Boolean(e),this.valueValid){var i=this.unitHandler.areaToString(e);this.setText(i)}ze(De(t.prototype),"update",this).call(this)}}]),t}(We),qe=function(e){function t(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Ge(this,t),(i=Me(this,De(t).call(this,e,n))).posA=new THREE.Vector2,i.posB=new THREE.Vector2,i.posValid=!1,i.edgeDir=new THREE.Vector2,i.poly=null,i.edgeIndex=0,i.container.classList.add("edge-gizmo"),i.maxRelativeLength=void 0,i}return Re(t,e),je(t,[{key:"attachToEdge",value:function(e,t){this.poly=e,this.edgeIndex=t,this.update()}},{key:"detachFromEdge",value:function(){this.poly=null,this.edgeIndex=-1,this.posValid=!1,this.update()}},{key:"update",value:function(){this.poly&&this.poly.edgeIndexValid(this.edgeIndex)&&(this.poly.getEdge(this.edgeIndex,this.posA,this.posB),this.posValid=!0);var e=this._shouldBeShown();this.container.style.visibility=e?"visible":"hidden",e&&(this.layerPos.set(.5*(this.posA.x+this.posB.x),.5*(this.posA.y+this.posB.y)),this._updateRotation(),ze(De(t.prototype),"update",this).call(this))}},{key:"_shouldBeShown",value:function(){if(!this.posValid)return!1;if(this.maxRelativeLength){var e=this.layer.layerToCanvas(this.posA.x,this.posA.y),t=this.layer.layerToCanvas(this.posB.x,this.posB.y),i=e.distanceTo(t)*this.maxRelativeLength;return parseFloat(window.getComputedStyle(this.container).width)<i}return!0}},{key:"_updateRotation",value:function(){var e=c.getEdgeDirection(this.posA,this.posB,this.edgeDir),t=Math.atan2(e.y,e.x);e.x<0&&(t+=Math.PI),this.angle=-THREE.Math.radToDeg(t)}}]),t}(Ke),Qe=function(e){function t(e,i){var n,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Ge(this,t),(n=Me(this,De(t).call(this,e,o))).setName(i),n.container.classList.add("edge-move-gizmo"),n.maxRelativeLength=.3,n}return Re(t,e),t}(qe),$e=function(e){function t(e){var i,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Ge(this,t),i=Me(this,De(t).call(this,e,n)),Ye(Oe(i)),i.maxRelativeLength=1,i}return Re(t,e),t}(qe),Je=function(e){function t(e,i,n,o){var r;return Ge(this,t),(r=Me(this,De(t).call(this,e,!0))).setPosition(i,n),r.setName(o),r.container.classList.add("vertex-gizmo"),r}return Re(t,e),t}(Ke),Ze=function(e,t){e.updateBBox();var i=e.bbox,n=i.max.x-i.min.x;return n*t.getPixelsPerUnit()*n},et=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return Ge(this,t),(e=Me(this,De(t).call(this))).minWidth=i,e}return Re(t,e),je(t,[{key:"accepts",value:function(e,t,i){var n=Ze(e,i);return Boolean(t)&&n>=this.minWidth}}]),t}(function(){function e(){Ge(this,e)}return je(e,[{key:"accepts",value:function(e,t){return!0}}]),e}()),tt=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;return Ge(this,t),(e=Me(this,De(t).call(this))).rangeStart=i,e.rangeEnd=n,e}return Re(t,e),je(t,[{key:"apply",value:function(e,t,i){var n=(Ze(t,i)-this.rangeStart)/(this.rangeEnd-this.rangeStart),o=THREE.Math.clamp(n,0,1);e.container.style.opacity=o}}]),t}(function(){function e(){Ge(this,e)}return je(e,[{key:"apply",value:function(e,t,i,n){}}]),e}()),it=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new et,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new tt;Ge(this,e),this.layer=t,this.shapeToLabelText=i,this.labels=[],this.labelsUsed=0,this.layer.addCanvasGizmo(this),this.visible=!0,this.layer.update(),this.filter=n,this.styleRule=o}return je(e,[{key:"setTextRule",value:function(e){this.shapeToLabelText=e,this.update()}},{key:"setVisible",value:function(e){e!==this.visible&&(e?(this.layer.addCanvasGizmo(this),this.update()):(this.clearLabels(),this.layer.removeCanvasGizmo(this)),this.visible=e)}},{key:"dtor",value:function(){this.setVisible(!1)}},{key:"clearLabels",value:function(){for(var e=0;e<this.labelsUsed;e++)this.labels[e].setShape(null),this.labels[e].setVisible(!1);this.labelsUsed=0}},{key:"acquireLabel",value:function(){return this.labelsUsed===this.labels.length&&this.labels.push(new We(null,this.layer)),this.labels[this.labelsUsed++]}},{key:"update",value:function(){this.clearLabels();for(var e=this.layer.shapes,t=0;t<e.length;t++){var i=e[t],n=this.shapeToLabelText(i);if(!this.filter||this.filter.accepts(i,n,this.layer)){var o=this.acquireLabel();o.setShape(i),o.setText(n),o.setVisible(!0),this.styleRule&&this.styleRule.apply(o,i,this.layer)}}}}]),e}();function nt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ot=Autodesk.Viewing,rt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.layer=t.layer,this.selection=t.selection,this.undoStack=t.undoStack,this.nameSuffix="_".concat(t.toolSetName),this.shape=null,this.dragStartPoint=new THREE.Vector2,this.backupShape=null,this.keyMap={CancelEdit:ot.KeyCode.ESCAPE},this.lastMousePos=new THREE.Vector2}var t,i,n;return t=e,(i=[{key:"getNames",value:function(){return[this.getName()]}},{key:"getName",value:function(){return"Edit2_MoveTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(0===t){var i=this.layer.canvasToLayer(e.canvasX,e.canvasY),n=this.layer.hitTest(i.x,i.y);return n&&this.startDrag(n,i),this.shape?this.selection.selectOnly(this.shape):this.selection.clear(),Boolean(this.shape)}}},{key:"startDrag",value:function(e,t){this.shape=e,this.dragStartPoint.copy(t),this.backupShape=e.clone()}},{key:"moveDrag",value:function(e){var t=e.x-this.dragStartPoint.x,i=e.y-this.dragStartPoint.y;this.shape.copy(this.backupShape),this.shape.move(t,i),this.layer.update()}},{key:"resetDragging",value:function(){this.shape=null,this.backupShape=null}},{key:"endDrag",value:function(e){if(this.shape){this.shape.copy(this.backupShape);var t=e.x-this.dragStartPoint.x,i=e.y-this.dragStartPoint.y;return this.undoStack.run(new X.MoveShape(this.layer,this.shape,t,i)),!!this.shape&&(this.shape=null,!0)}}},{key:"cancelDrag",value:function(){this.isDragging()&&(this.shape.copy(this.backupShape),this.layer.update(),this.resetDragging())}},{key:"isDragging",value:function(){return Boolean(this.shape)}},{key:"handleMouseMove",value:function(e){var t=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.lastMousePos.copy(t),!!this.shape&&(this.moveDrag(t),!0)}},{key:"handleButtonUp",value:function(e,t){if(0===t){var i=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.endDrag(i)}}},{key:"handleKeyDown",value:function(e,t){t===this.keyMap.CancelEdit&&this.cancelDrag()}},{key:"getCursor",value:function(){return this.shape?"move":this.layer.hitTest(this.lastMousePos.x,this.lastMousePos.y)?"move":void 0}}])&&nt(t.prototype,i),n&&nt(t,n),e}();function st(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var at=Autodesk.Viewing,lt=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t.viewer,this.layer=t.layer,this.gizmoLayer=t.gizmoLayer,this.snapper=t.snapper,this.selection=t.selection,this.undoStack=t.undoStack,this.unitHandler=t.unitHandler,this.nameSuffix="_".concat(t.toolSetName),this.ignoreDragging=!1,this.ignoreActions=!1,this.onActionCb=function(e){i.ignoreActions||i.handleExternalAction(e)},this.suppressSnapping=!1,this.keyMap={SnapKey:at.KeyCode.SHIFT,PanKey:at.KeyCode.SPACE},this.selection&&(this.selectionCb=function(){i.active&&i.onSelectionChanged&&i.onSelectionChanged()},this.selection.addEventListener(G.Events.SELECTION_CHANGED,this.selectionCb)),this.active=!1,this.canvasPos=new THREE.Vector2,this.keyState={ctrl:!1,shift:!1,alt:!1}}var t,i,n;return t=e,(i=[{key:"getSnapPosition",value:function(e,t){var i=this;return this.snapper&&!this.suppressSnapping?this.snapper.getSnapPosition(e,t,(function(e){return i.snappingFilter(e)})):(this.snapper.clearSnappingGizmos(),this.layer.canvasToLayer(e,t))}},{key:"dtor",value:function(){this.selectionCb&&this.selection.removeEventListener(G.Events.SELECTION_CHANGED,this.selectionCb)}},{key:"getNames",value:function(){return[this.getName()]}},{key:"handleKeyDown",value:function(e,t){if(this.keyState[t]=!0,t!==this.keyMap.SnapKey||this.suppressSnapping||(this.suppressSnapping=!0,this.onSnappingToggled&&this.onSnappingToggled(this.canvasPos.x,this.canvasPos.y)),t===at.KeyCode.BACKSPACE)return!0;t===this.keyMap.PanKey&&(this.ignoreDragging=!0)}},{key:"handleKeyUp",value:function(e,t){this.keyState[t]=!1,t===this.keyMap.SnapKey&&this.suppressSnapping&&(this.suppressSnapping=!1,this.onSnappingToggled&&this.onSnappingToggled(this.canvasPos.x,this.canvasPos.y)),t===this.keyMap.PanKey&&(this.ignoreDragging=!1)}},{key:"handleExternalAction",value:function(e){}},{key:"runAction",value:function(e){this.ignoreActions=!0,this.undoStack.run(e),this.ignoreActions=!1}},{key:"activate",value:function(){this.active=!0,this.undoStack.addEventListener(D.AFTER_ACTION,this.onActionCb)}},{key:"deactivate",value:function(){this.active=!1,this.undoStack.removeEventListener(D.AFTER_ACTION,this.onActionCb),this.snapper&&this.snapper.clearSnappingGizmos()}},{key:"register",value:function(){}},{key:"mapKey",value:function(e,t){for(var i in t){var n=t[i];if(e.keyCode==n)return i;if(Array.isArray(n)&&n.includes(e.keyCode))return i}return null}},{key:"snappingFilter",value:function(){return!0}},{key:"trackMousePos",value:function(e){this.canvasPos.set(e.canvasX,e.canvasY)}},{key:"handleMouseMove",value:function(e){this.trackMousePos(e)}},{key:"handleSingleClick",value:function(e){this.trackMousePos(e)}},{key:"handleDoubleClick",value:function(e){this.trackMousePos(e)}},{key:"handleButtonUp",value:function(e){this.trackMousePos(e)}},{key:"handleButtonDown",value:function(e){this.trackMousePos(e)}}])&&st(t.prototype,i),n&&st(t,n),e}();function ht(e){return(ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ut(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ct(e){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dt(e,t){return(dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ft=Autodesk.Viewing,yt=function(e){function t(e){var i,n,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,i=!(o=ct(t).call(this,e))||"object"!==ht(o)&&"function"!=typeof o?pt(n):o,Autodesk.Viewing.EventDispatcher.prototype.apply(pt(i)),i.style=r,i.rect=null,i.startPoint=new THREE.Vector2,i.endPoint=new THREE.Vector2,i.dragCanceled=!1,i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dt(e,t)}(t,e),i=t,(n=[{key:"getName",value:function(){return"Edit2_RectangleTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(0==t){var i=this.getSnapPosition(e.canvasX,e.canvasY);return this.startDrag(i),!0}}},{key:"handleButtonUp",value:function(e,t){return 0==t&&(this.dragCanceled?(this.dragCanceled=!1,!0):(this.handleMouseMove(e),this.endDrag()))}},{key:"handleMouseMove",value:function(e){var t=this.getSnapPosition(e.canvasX,e.canvasY);return!!this.rect&&(this.moveDrag(t,e.shiftKey),!0)}},{key:"startDrag",value:function(e){this.rect=new _([e.clone(),e.clone(),e.clone(),e.clone()],this.style.clone()),this.startPoint.copy(e),this.endPoint.copy(e),this.gizmoLayer.addShape(this.rect)}},{key:"updateRect",value:function(e){if(this.isDragging()){var t=this.startPoint,i=this.endPoint;if(e){var n=i.x-t.x,o=i.y-t.y,r=Math.max(Math.abs(n),Math.abs(o)),s=Math.sign(n),a=Math.sign(o);this.rect.updatePoint(1,t.x+r*s,t.y),this.rect.updatePoint(2,t.x+r*s,t.y+r*a),this.rect.updatePoint(3,t.x,t.y+r*a)}else this.rect.updatePoint(1,i.x,t.y),this.rect.updatePoint(2,i.x,i.y),this.rect.updatePoint(3,t.x,i.y);this.gizmoLayer.update()}}},{key:"moveDrag",value:function(e,t){this.endPoint.copy(e),this.updateRect(t)}},{key:"endDrag",value:function(){if(!this.rect)return!1;var e=this.endPoint.x-this.startPoint.x,t=this.endPoint.y-this.startPoint.y,i=Math.abs(e)>1e-10&&Math.abs(t)>1e-10;return this.gizmoLayer.removeShape(this.rect),i&&this.undoStack.run(new X.AddShape(this.layer,this.rect)),this.rect=null,!0}},{key:"cancelDrag",value:function(){this.rect&&(this.gizmoLayer.removeShape(this.rect),this.rect=null,this.dragCanceled=!0)}},{key:"isDragging",value:function(){return Boolean(this.rect)}},{key:"handleKeyDown",value:function(e,t){t==ft.KeyCode.SHIFT&&this.updateRect(!0)}},{key:"handleKeyUp",value:function(e,t){t==ft.KeyCode.SHIFT&&this.updateRect(!1)}}])&&ut(i.prototype,n),o&&ut(i,o),t}(lt);function vt(e){return(vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function mt(e,t){return!t||"object"!==vt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function bt(e){return(bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xt(e,t){return(xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var kt=Autodesk.Viewing,St=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=mt(this,bt(t).call(this,e))).style=n,i.line=null,i.startPoint=new THREE.Vector2,i.endPoint=new THREE.Vector2,i.dragCanceled=!1,i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xt(e,t)}(t,e),i=t,(n=[{key:"getName",value:function(){return"Edit2_LineTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"handleButtonDown",value:function(e,t){if(0==t){var i=this.getSnapPosition(e.canvasX,e.canvasY);return this.startDrag(i),!0}}},{key:"handleButtonUp",value:function(e,t){if(0==t)return this.handleMouseMove(e),this.dragCanceled?(this.dragCanceled=!1,!0):this.endDrag()}},{key:"handleMouseMove",value:function(e){var t=this.getSnapPosition(e.canvasX,e.canvasY);return!!this.line&&(this.moveDrag(t,e.shiftKey),!0)}},{key:"startDrag",value:function(e){this.line=new L([e.clone(),e.clone()],this.style.clone()),this.startPoint.copy(e),this.endPoint.copy(e),this.gizmoLayer.addShape(this.line)}},{key:"updateLine",value:function(){this.isDragging()&&(this.line.updatePoint(1,this.endPoint.x,this.endPoint.y),this.gizmoLayer.update())}},{key:"moveDrag",value:function(e,t){this.endPoint.copy(e),this.updateLine()}},{key:"endDrag",value:function(){return!!this.line&&(this.gizmoLayer.removeShape(this.line),!c.edgeIsDegenerated(this.startPoint,this.endPoint)&&this.undoStack.run(new X.AddShape(this.layer,this.line)),this.line=null,!0)}},{key:"cancelDrag",value:function(){this.line&&(this.gizmoLayer.removeShape(this.line),this.line=null,this.dragCanceled=!0)}},{key:"isDragging",value:function(){return Boolean(this.line)}},{key:"handleKeyDown",value:function(e,t){t==kt.KeyCode.SHIFT&&this.updateLine(!0)}},{key:"handleKeyUp",value:function(e,t){t==kt.KeyCode.SHIFT&&this.updateLine(!1)}}])&&gt(i.prototype,n),o&&gt(i,o),t}(lt);function Et(e){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Tt(e,t,i){return(Tt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ct(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function Ct(e){return(Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function At(e,t){return(At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _t={Polyline:1,Polygon:2},Lt=Autodesk.Viewing,Vt=new w,zt=function(e){function t(e){var i,n,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_t.Polygon,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,(i=!(o=Ct(t).call(this,e))||"object"!==Et(o)&&"function"!=typeof o?Pt(n):o).lineRectTool=r===_t.Polygon?new yt(e,s):new St(e,s),Autodesk.Viewing.EventDispatcher.prototype.apply(Pt(i)),i.vertexGizmos=[],i.poly=void 0,i.style=s,i.edgePreviewStyle=new w({lineWidth:2,isScreenSpace:!0,lineStyle:11}),i.mode=r,i.lastClickX=void 0,i.lastClickY=void 0,i.keyMap.CANCEL_EDIT=Lt.KeyCode.ESCAPE,i.keyMap.REMOVE_LAST_VERTEX=Lt.KeyCode.BACKSPACE,i.keyMap.FINISH_EDIT=[Lt.KeyCode.ENTER,Lt.KeyCode.c],i.fillGizmo=null,i.outlineGizmo=null,i.edgePreviewGizmo=null,i.mousePos=new THREE.Vector2,i.areaLabel=new Xe(null,i.gizmoLayer,i.unitHandler,!1),i.lengthLabel=new $e(i.gizmoLayer,!1),i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(t,e),i=t,(n=[{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"setLengthLabelVisible",value:function(e){this.lengthLabel.setVisible(e)}},{key:"deactivate",value:function(){Tt(Ct(t.prototype),"deactivate",this).call(this),this.cancelEdit()}},{key:"isPolygon",value:function(){return this.poly instanceof _}},{key:"setStyles",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.lineColor===Vt.lineColor&&t||(this.style.lineColor=e.lineColor),e.lineAlpha===Vt.lineAlpha&&t||(this.style.lineAlpha=e.lineAlpha),e.lineWidth===Vt.lineWidth&&t||(this.style.lineWidth=e.lineWidth,this.lineRectTool.style.lineWidth=e.lineWidth,this.edgePreviewStyle.lineWidth=2*e.lineWidth/3),e.lineStyle===Vt.lineStyle&&t||(this.style.lineStyle=e.lineStyle,this.lineRectTool.style.lineStyle=e.lineStyle),e.fillColor===Vt.fillColor&&t||(this.style.fillColor=e.fillColor),e.fillAlpha===Vt.fillAlpha&&t||(this.style.fillAlpha=e.fillAlpha)}},{key:"initGizmos",value:function(){this.isPolygon()&&(this.fillGizmo=new _([],this.style.clone()),this.fillGizmo.style.lineAlpha=0,this.gizmoLayer.addShape(this.fillGizmo)),this.outlineGizmo=new L([],this.style.clone()),this.gizmoLayer.addShape(this.outlineGizmo),this.edgePreviewGizmo=new L([],this.edgePreviewStyle),this.edgePreviewGizmo.style.lineColor=this.poly.style.lineColor,this.gizmoLayer.addShape(this.edgePreviewGizmo),this.areaLabel.setShape(this.fillGizmo),this.poly&&this.poly.isPolyline()&&this.lengthLabel.attachToEdge(this.edgePreviewGizmo,0)}},{key:"clearGizmos",value:function(){this.fillGizmo&&(this.gizmoLayer.removeShape(this.fillGizmo),this.fillGizmo=null),this.areaLabel.setShape(null),this.lengthLabel.detachFromEdge(),this.outlineGizmo&&(this.gizmoLayer.removeShape(this.outlineGizmo),this.outlineGizmo=null),this.edgePreviewGizmo&&(this.gizmoLayer.removeShape(this.edgePreviewGizmo),this.edgePreviewGizmo=null);for(var e=0;e<this.vertexGizmos.length;e++)this.vertexGizmos[e].dtor();this.vertexGizmos.length=0}},{key:"polyModified",value:function(){this.updateGizmos();var e=this.poly.clone();e.addPoint(this.mousePos.x,this.mousePos.y),this.snapper.startAngleSnapping(e,this.poly.length)}},{key:"updateGizmos",value:function(){if(this.fillGizmo){this.fillGizmo.clear();for(var e=0;e<this.poly.length;e++){var t=this.poly.getPoint(e);this.fillGizmo.addPoint(t.x,t.y)}this.fillGizmo.addPoint(this.mousePos.x,this.mousePos.y)}if(this.outlineGizmo.clear(),this.poly.length>=2)for(var i=0;i<this.poly.length;i++){var n=this.poly.getPoint(i);this.outlineGizmo.addPoint(n.x,n.y)}if(this.edgePreviewGizmo.clear(),this.poly.length>=1){var o=this.poly.getPoint(this.poly.length-1);this.edgePreviewGizmo.addPoint(o.x,o.y),this.edgePreviewGizmo.addPoint(this.mousePos.x,this.mousePos.y),this.updateLengthLabel()}this.gizmoLayer.update()}},{key:"updateLengthLabel",value:function(){if(this.poly&&this.poly.isPolyline()){var e=this.poly.getLength()+this.edgePreviewGizmo.getLength(),t=this.unitHandler.lengthToString(e);this.lengthLabel.setText(t)}}},{key:"getName",value:function(){return(this.mode===_t.Polygon?"Edit2_PolygonTool":"Edit2_PolylineTool")+this.nameSuffix}},{key:"handleMouseMove",value:function(e){return Tt(Ct(t.prototype),"handleMouseMove",this).call(this,e),e.buttons?this.lineRectTool.handleMouseMove(e):(this.onHover(e.canvasX,e.canvasY),!1)}},{key:"onHover",value:function(e,t){if(this.poly){var i=this.layer.canvasToLayer(e,t),n=this.poly.length>=3&&this.vertexGizmos[0].isUnderMouse;this.setStartVertexHighlighted(n),n?(this.snapper.clearSnappingGizmos(),i.copy(this.vertexGizmos[0].layerPos)):i=this.getSnapPosition(e,t),this.mousePos.copy(i),this.edgePreviewGizmo.updatePoint(1,i.x,i.y),this.fillGizmo&&this.fillGizmo.updatePoint(this.fillGizmo.length-1,i.x,i.y),this.gizmoLayer.update(),this.updateLengthLabel()}else this.getSnapPosition(e,t)}},{key:"handleStartVertexClicked",value:function(e){if(this.poly||!(this.poly.length<3)){if(this.poly.isPolyline()){var t=this.poly.getPoint(0);this.addVertex(t.x,t.y)}this.finishPolygon(),e.stopPropagation()}}},{key:"handleSingleClick",value:function(e,i){return Tt(Ct(t.prototype),"handleSingleClick",this).call(this,e,i),0!=!i&&(this.vertexGizmos.length>0&&e.canvasX===this.lastClickX&&e.canvasY===this.lastClickY||(this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.mousePos.copy(this.getSnapPosition(e.canvasX,e.canvasY)),this.poly||this.startPoly(this.mousePos.x,this.mousePos.y),this.addVertex(this.mousePos.x,this.mousePos.y),!0))}},{key:"handleButtonDown",value:function(e,t){return!this.ignoreDragging&&!this.poly&&(this.selection.clear(),this.lineRectTool.handleButtonDown(e,t))}},{key:"handleButtonUp",value:function(e,t){return this.lineRectTool.handleButtonUp(e,t)}},{key:"handleDoubleClick",value:function(e,i){return Tt(Ct(t.prototype),"handleDoubleClick",this).call(this,e,i),0!=!i&&(this.finishPolygon(),!0)}},{key:"startPoly",value:function(e,t){this.mode===_t.Polygon?this.poly=new _([],this.style.clone()):this.poly=new L([],this.style.clone()),this.initGizmos()}},{key:"addVertex",value:function(e,t){var i=this;this.poly.addPoint(e,t);var n="PolygonTool_vertexGizmo_"+this.vertexGizmos.length,o=new Je(this.gizmoLayer,e,t,n);this.vertexGizmos.push(o),1===this.vertexGizmos.length&&o.container.addEventListener("click",(function(e){return i.handleStartVertexClicked(e)})),this.polyModified()}},{key:"removeLastVertex",value:function(){this.poly&&this.poly.length&&(this.poly.length<=1?this.cancelEdit():(this.poly.removePoint(this.poly.length-1),this.vertexGizmos[this.vertexGizmos.length-1].dtor(),this.vertexGizmos.pop(),this.polyModified()))}},{key:"finishPolygon",value:function(){this.clearGizmos(),this.snapper.stopAngleSnapping(),this.runAction(new X.AddShape(this.layer,this.poly)),this.dispatchEvent({type:t.POLYGON_ADDED,polygon:this.poly}),this.poly=null}},{key:"cancelEdit",value:function(){this.lineRectTool.isDragging()&&this.lineRectTool.cancelDrag(),this.poly&&(this.gizmoLayer.removeShape(this.poly),this.poly=null),this.clearGizmos(),this.snapper.stopAngleSnapping()}},{key:"handleFinishKey",value:function(e){return!(!this.poly||this.isPolygon()&&this.poly.length<3||(this.finishPolygon(),0))}},{key:"handleKeyDown",value:function(e,i){var n=Tt(Ct(t.prototype),"handleKeyDown",this).call(this,e,i);switch(n=this.lineRectTool.handleKeyDown(e,i)||n,this.mapKey(e,this.keyMap)){case"CANCEL_EDIT":this.cancelEdit(),n=!0;break;case"REMOVE_LAST_VERTEX":this.removeLastVertex(),n=!0;break;case"FINISH_EDIT":n=this.handleFinishKey(e)}return n}},{key:"handleKeyUp",value:function(e,i){Tt(Ct(t.prototype),"handleKeyUp",this).call(this,e,i),this.lineRectTool.handleKeyUp(e,i)}},{key:"onSnappingToggled",value:function(e,t){this.onHover(e,t)}},{key:"mouseOnStartVertex",value:function(e){return!!this.vertexGizmos[0]&&(this.layer.canvasToLayer(e.canvasX,e.canvasY),this.vertexGizmos[0].isUnderMouse)}},{key:"setStartVertexHighlighted",value:function(e){this.vertexGizmos[0]&&this.vertexGizmos[0].setSelected(e)}},{key:"getCursor",value:function(){return"crosshair"}}])&&wt(i.prototype,n),o&&wt(i,o),t}(lt);function Mt(e){return(Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ot(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Dt(e,t){return!t||"object"!==Mt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Rt(e,t,i){return(Rt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=It(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function It(e){return(It=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gt(e,t){return(Gt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}zt.POLYGON_ADDED="polygonAdded",zt.Mode=_t;var Bt=Autodesk.Viewing,jt=function(e){return"PolygonEditTool_vertexGizmo_"+e.toString()},Ht=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.name=jt(t),i.update(!1)}},Ut=function(e){function t(e){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=Dt(this,It(t).call(this,e))).moveTool=new rt(e),i.poly=null,i.lastDragPoint=new THREE.Vector2,i.vertexGizmos=[],i.draggedVertex=-1,i.dragVertexStartPos=new THREE.Vector2,i.dragEdgeStartPos={a:new THREE.Vector2,b:new THREE.Vector2},i.draggedEdge=-1,i.draggedEdgeNormal=new THREE.Vector2,i.selectedVertex=-1,i.dragOffset=new THREE.Vector2(0,0),i.edgeGizmo=new L,i.edgeGizmoShown=!1,i.keyMap.DeleteSelectedVertex=Bt.KeyCode.BACKSPACE,i.keyMap.CancelEdit=Bt.KeyCode.ESCAPE,i.mousePos=new THREE.Vector2,i.areaLabel=new Xe(null,i.layer,e.unitHandler,!1),i.edgeGizmos=[],i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gt(e,t)}(t,e),i=t,(n=[{key:"setAreaLabelVisible",value:function(e){this.areaLabel.setVisible(e)}},{key:"getName",value:function(){return"Edit2_PolygonEditTool"+this.nameSuffix}},{key:"deactivate",value:function(){Rt(It(t.prototype),"deactivate",this).call(this),this.reset()}},{key:"createVertexGizmos",value:function(){for(var e=0;e<this.poly.points.length;e++){var t=this.poly.points[e],i=new Je(this.gizmoLayer,t.x,t.y,jt(e),this.poly.style);this.vertexGizmos.push(i),i.setHoverEnabled(!0)}}},{key:"updateVertexGizmos",value:function(){var e=this.poly?this.poly.length:0,t=new THREE.Vector2;if(e==this.vertexGizmos.length)for(var i=0;i<e;i++)this.poly.getPoint(i,t),this.vertexGizmos[i].setPosition(t.x,t.y);else this.clearVertexGizmos(),this.createVertexGizmos()}},{key:"clearVertexGizmos",value:function(){for(var e=0;e<this.vertexGizmos.length;e++)this.vertexGizmos[e].dtor();this.vertexGizmos.length=0}},{key:"clearEdgeGizmos",value:function(){for(var e=0;e<this.edgeGizmos.length;e++)this.edgeGizmos[e].dtor();this.edgeGizmos.length=0}},{key:"createEdgeGizmos",value:function(){this.clearEdgeGizmos();for(var e=this.poly?this.poly.getEdgeCount():0,t=0;t<e;t++){var i=new Qe(this.layer,"PolygonEditTool_edgeGizmo_"+t.toString());i.attachToEdge(this.poly,t),this.edgeGizmos.push(i)}}},{key:"updateVertexHighlighting",value:function(){for(var e=0;e<this.vertexGizmos.length;e++)this.vertexGizmos[e].setSelected(e===this.selectedVertex)}},{key:"setSelectedVertex",value:function(e){this.selectedVertex=this.poly?e:-1,this.updateVertexHighlighting()}},{key:"getVertexIndex",value:function(e,t){for(var i=0;i<this.vertexGizmos.length;i++)if(this.vertexGizmos[i].isUnderMouse)return i;return-1}},{key:"getEdgeIndex",value:function(e,t){for(var i=0;i<this.edgeGizmos.length;i++)if(this.edgeGizmos[i].isUnderMouse)return i;return-1}},{key:"reset",value:function(){this.poly&&(this.clearVertexGizmos(),this.clearEdgeGizmos(),this.areaLabel.setShape(null),this.poly=null,this.draggedVertex=-1,this.selectedVertex=-1,this.snapper.stopAngleSnapping())}},{key:"setEditPoly",value:function(e){this.reset(),e&&(this.poly=e,this.createVertexGizmos(),this.createEdgeGizmos());var t=e&&e.isPolygon()?e:null;this.areaLabel.setShape(t)}},{key:"insertPoint",value:function(e,t){this.runAction(new X.AddVertex(this.layer,this.poly,e,t));var i=new Je(this.gizmoLayer,t.x,t.y,void 0,this.poly.style);this.vertexGizmos.splice(e,0,i),Ht(this.vertexGizmos),this.createEdgeGizmos(),this.layer.update()}},{key:"removePoint",value:function(e){var t=this.poly.isPolygon()?3:2;if(this.poly.length<=t)return this.runAction(new X.RemoveShape(this.layer,this.poly)),void this.reset();this.runAction(new X.RemoveVertex(this.layer,this.poly,e));var i=this.vertexGizmos.splice(e,1)[0];Ht(this.vertexGizmos),this.createEdgeGizmos(),i.dtor(),this.selectedVertex===e&&this.setSelectedVertex(-1),this.layer.update()}},{key:"startDragVertex",value:function(e,t){this.snapper.startAngleSnapping(this.poly.clone(),t),this.draggedVertex=t;var i=this.poly.points[this.draggedVertex],n=this.layer.layerToCanvas(i.x,i.y);this.dragOffset.set(n.x-e.canvasX,n.y-e.canvasY),this.setSelectedVertex(this.draggedVertex),this.lastDragPoint.copy(i),this.dragVertexStartPos.copy(i)}},{key:"moveDragVertex",value:function(e,t){var i=e+this.dragOffset.x,n=t+this.dragOffset.y,o=this.getSnapPosition(i,n),r=o.x-this.lastDragPoint.x,s=o.y-this.lastDragPoint.y,a=this.poly.points[this.draggedVertex];this.poly.updatePoint(this.draggedVertex,a.x+r,a.y+s),this.vertexGizmos[this.draggedVertex].setPosition(a.x,a.y),this.gizmoLayer.update(),this.layer.update(),this.lastDragPoint.copy(o)}},{key:"restoreDragVertex",value:function(){this.poly.updatePoint(this.draggedVertex,this.dragVertexStartPos.x,this.dragVertexStartPos.y)}},{key:"endDragVertex",value:function(){this.restoreDragVertex();var e=this.dragVertexStartPos,t=this.lastDragPoint,i=.5*this.layer.getUnitsPerPixel();e.distanceTo(t)>i&&this.runAction(new X.MoveVertex(this.layer,this.poly,this.draggedVertex,t)),this.draggedVertex=-1,this.snapper.clearSnappingGizmos()}},{key:"startDragEdge",value:function(e,t){this.setSelectedEdge(t),this.draggedEdgeNormal=function(e,t,i){var n=t,o=(t+1)%e.length,r=e.getPoint(n),s=e.getPoint(o);i.subVectors(s,r).normalize();var a=i.x;return i.x=-i.y,i.y=a,i}(this.poly,t,this.draggedEdgeNormal),this.lastDragPoint.copy(this.layer.canvasToLayer(e.canvasX,e.canvasY));var i=this.draggedEdge,n=(this.draggedEdge+1)%this.poly.length;this.dragEdgeStartPos.a.copy(this.poly.getPoint(i)),this.dragEdgeStartPos.b.copy(this.poly.getPoint(n))}},{key:"moveDragEdge",value:function(e){var t=this.layer.canvasToLayer(e.canvasX,e.canvasY),i=t.clone().sub(this.lastDragPoint),n=this.poly.prevIndex(this.draggedEdge),o=this.poly.nextIndex(this.draggedEdge),r=new THREE.Vector2,s=new THREE.Vector2,a=new THREE.Vector2,l=new THREE.Vector2,h=new THREE.Vector2,u=new THREE.Vector2;this.poly.getEdge(n,r,s),this.poly.getEdge(this.draggedEdge,a,l),this.poly.getEdge(o,h,u),a.add(i),l.add(i);var p=c.getEdgeDirection(r,s),d=c.getEdgeDirection(a,l),f=c.getEdgeDirection(h,u),y=new THREE.Vector2,v=new THREE.Vector2;if(c.intersectLines(r,p,a,d,y)&&c.intersectLines(h,f,a,d,v)){var g=this.draggedEdge,m=this.poly.nextIndex(g);this.poly.updatePoint(g,y.x,y.y),this.poly.updatePoint(m,v.x,v.y),this.vertexGizmos[g].setPosition(y.x,y.y),this.vertexGizmos[m].setPosition(v.x,v.y),this.gizmoLayer.update(),this.layer.update(),this.lastDragPoint.copy(t),this.updateEdgeGizmo()}}},{key:"restoreDragEdge",value:function(){var e=this.dragEdgeStartPos.a,t=this.dragEdgeStartPos.b,i=this.draggedEdge,n=this.poly.nextIndex(i);this.poly.updatePoint(i,e.x,e.y),this.poly.updatePoint(n,t.x,t.y)}},{key:"endDragEdge",value:function(){var e=this.draggedEdge,t=this.poly.nextIndex(e),i=this.poly.getPoint(e),n=this.poly.getPoint(t);this.restoreDragEdge(),this.runAction(new X.MoveEdge(this.layer,this.poly,e,i,n)),this.setSelectedEdge(-1)}},{key:"edgeMovePossible",value:function(){return this.poly&&this.poly.length>2}},{key:"handleButtonDown",value:function(e,i){if(this.ignoreDragging)return!1;if(Rt(It(t.prototype),"handleButtonDown",this).call(this,e,i),0==!i)return!1;var n=this.layer.canvasToLayer(e.canvasX,e.canvasY);this.mousePos.copy(n);var o=this.getVertexIndex(n.x,n.y);if(-1!=o)return this.startDragVertex(e,o),!0;var r=-1;if(e.ctrlKey){var s=17*this.layer.getUnitsPerPixel(),a=this.poly?this.poly.findEdgeIndex(this.mousePos,s):-1;if(-1!==a)return r=a+1,this.insertPoint(r,n),this.startDragVertex(e,r),!0}this.setSelectedVertex(-1);var l=this.getEdgeIndex(n.x,n.y);if(this.edgeMovePossible()&&-1!==l)return this.startDragEdge(e,l),!0;if(this.poly){var h=this.layer.getLineHitRadius(this.poly);if(this.poly.hitTest(n.x,n.y,h))return this.moveTool.startDrag(this.poly,n),!0}var u=this.layer.hitTest(n.x,n.y);return u instanceof _||u instanceof L||(u=null),this.selection.selectOnly(u),Boolean(this.poly)}},{key:"handleSingleClick",value:function(e){return Rt(It(t.prototype),"handleSingleClick",this).call(this,e),Boolean(this.poly)}},{key:"handleMouseMove",value:function(e){return Rt(It(t.prototype),"handleMouseMove",this).call(this,e),this.mousePos.copy(this.layer.canvasToLayer(e.canvasX,e.canvasY)),this.updateMouseOverHighlights(),!!this.poly&&(-1!=this.draggedVertex?(this.moveDragVertex(e.canvasX,e.canvasY),!0):(-1!=this.draggedEdge&&this.moveDragEdge(e),this.moveTool.isDragging()&&(this.moveTool.moveDrag(this.mousePos),this.updateVertexGizmos()),!1))}},{key:"handleButtonUp",value:function(e,i){if(Rt(It(t.prototype),"handleButtonUp",this).call(this,e,i),-1!==this.draggedVertex)return this.endDragVertex(),!0;if(-1!==this.draggedEdge)return this.endDragEdge(),!0;if(this.moveTool.isDragging()){var n=this.layer.canvasToLayer(e.canvasX,e.canvasY);return this.ignoreActions=!0,this.moveTool.endDrag(n),this.ignoreActions=!1,this.updateVertexGizmos(),!0}return!this.ignoreDragging&&this.poly&&0==i}},{key:"snappingFilter",value:function(e){return e!==this.poly}},{key:"onSelectionChanged",value:function(){var e=this.selection.getSelectedShapes()[0];e instanceof A?this.setEditPoly(e):this.setEditPoly(null)}},{key:"handleKeyDown",value:function(e,i){var n=Rt(It(t.prototype),"handleKeyDown",this).call(this,e,i);return i===this.keyMap.DeleteSelectedVertex&&this.poly&&-1!==this.selectedVertex&&(this.removePoint(this.selectedVertex),n=!0),i===this.keyMap.CancelEdit?(this.cancelDrag(),!0):n}},{key:"onSnappingToggled",value:function(e,t){-1!==this.draggedVertex&&this.moveDragVertex(e,t)}},{key:"cancelDrag",value:function(){var e=!1;-1!==this.draggedVertex&&(this.restoreDragVertex(),this.draggedVertex=-1,e=!0),-1!==this.draggedEdge&&(this.restoreDragEdge(),this.draggedEdge=-1,e=!0),this.moveTool.isDragging()&&(this.moveTool.cancelDrag(),this.updateVertexGizmos()),e&&(this.layer.update(),this.updateVertexGizmos()),this.snapper.clearSnappingGizmos()}},{key:"handleExternalAction",value:function(){this.poly&&(Boolean(this.layer.findShapeById(this.poly.id))||this.reset(),this.updateVertexGizmos(),this.cancelDrag(),this.snapper.clearSnappingGizmos())}},{key:"updateEdgeGizmo",value:function(){var e=this.getEdgeIndex(this.mousePos.x,this.mousePos.y),t=-1!=this.getVertexIndex(this.mousePos.x,this.mousePos.y)||-1!=this.draggedVertex,i=this.edgeMovePossible(),n=this.poly&&-1!=this.draggedEdge,o=n||i&&-1!=e&&!t;if(o&&!this.edgeGizmoShown?(this.gizmoLayer.addShape(this.edgeGizmo),this.edgeGizmoShown=!0):!o&&this.edgeGizmoShown&&(this.gizmoLayer.removeShape(this.edgeGizmo),this.edgeGizmoShown=!1),o){var r=n?this.draggedEdge:e,s=new THREE.Vector2,a=new THREE.Vector2;this.poly.getEdge(r,s,a),this.edgeGizmo.makeLine(s.x,s.y,a.x,a.y),this.edgeGizmo.style.lineWidth=this.poly.style.lineWidth,this.edgeGizmo.style.isScreenSpace=this.poly.style.isScreenSpace,n?(this.edgeGizmo.style.lineColor="rgb(0, 255, 0)",this.edgeGizmo.style.lineAlpha=1):(this.edgeGizmo.style.lineColor="rgb(0, 255, 0)",this.edgeGizmo.style.lineAlpha=.5),this.gizmoLayer.update()}}},{key:"setSelectedEdge",value:function(e){this.draggedEdge=e,this.updateEdgeGizmo();for(var t=0;t<this.edgeGizmos.length;t++)this.edgeGizmos[t].setSelected(t==this.draggedEdge)}},{key:"updateMouseOverHighlights",value:function(){this.updateEdgeGizmo()}},{key:"getCursor",value:function(){if(this.poly){var e=this.mousePos;if(this.moveTool.isDragging())return"move";if(-1!=this.draggedVertex||-1!=this.draggedEdge)return"move";if(this.keyState[Bt.KeyCode.CONTROL]){var t=17*this.layer.getUnitsPerPixel();if(-1!==(this.poly?this.poly.findEdgeIndex(this.mousePos,t):-1))return"copy"}var i=this.layer.getLineHitRadius(this.poly);return this.poly.hitTest(e.x,e.y,i)?"move":void 0}}}])&&Ot(i.prototype,n),o&&Ot(i,o),t}(lt);function Nt(e){return(Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ft(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Kt(e){return(Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Yt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wt(e,t){return(Wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xt=function(e){function t(e){var i,n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,i=!(o=Kt(t).call(this,e))||"object"!==Nt(o)&&"function"!=typeof o?Yt(n):o,Autodesk.Viewing.EventDispatcher.prototype.apply(Yt(i)),i.symbol=new V(0,0,.2,new w({fillAlpha:1,lineWidth:.01,fillColor:"rgb(255, 255, 0)"})),i}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wt(e,t)}(t,e),i=t,(n=[{key:"getName",value:function(){return"Edit2_InsertSymbolTool"+this.nameSuffix}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}},{key:"setSymbol",value:function(e){this.symbol=e}},{key:"handleMouseMove",value:function(e){}},{key:"handleSingleClick",value:function(e){var i=this.layer.canvasToLayer(e.canvasX,e.canvasY),n=this.symbol.clone();return n.move(i.x,i.y),this.undoStack.run(new X.AddShape(this.layer,n)),this.dispatchEvent({type:t.SYMBOL_INSERTED,symbol:n}),!0}},{key:"handleDoubleClick",value:function(){return!0}},{key:"getCursor",value:function(){return"crosshair"}}])&&Ft(i.prototype,n),o&&Ft(i,o),t}(lt);function qt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Xt.SYMBOL_INSERTED="symbolInserted";var Qt=Autodesk.Viewing,$t=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.undoStack=t}var t,i,n;return t=e,(i=[{key:"handleKeyDown",value:function(e,t){if(t!==Qt.KeyCode.z||!e.ctrlKey)return!1;e.shiftKey?this.undoStack.redo():this.undoStack.undo()}},{key:"getName",value:function(){return"Edit2_UndoTool"}},{key:"getNames",value:function(){return[this.getName()]}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}}])&&qt(t.prototype,i),n&&qt(t,n),e}();function Jt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Zt=Autodesk.Viewing,ei=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.viewer=t.viewer,this.layer=t.layer,this.selection=t.selection,this.undoStack=t.undoStack,this.nameSuffix="_".concat(t.toolSetName),this.clipBoard=[],this.pasteCounter=0}var t,i,n;return t=e,(i=[{key:"copy",value:function(){this.clipBoard.length=0;var e=this.selection.getSelectedShapes();this.originalShapes=e,this.clipBoard=e.slice(),this.pasteCounter=0}},{key:"paste",value:function(){this.pasteCounter++;var t=30*this.pasteCounter*this.layer.getUnitsPerPixel(),i=[],n={type:e.BEFORE_PASTE,originalShapes:this.originalShapes,veto:!1};if(this.dispatchEvent(n),!n.veto){for(var o=0;o<this.clipBoard.length;o++){var r=this.clipBoard[o].clone();r.move(t,t),i.push(r)}this.selection.setSelection(i),this.undoStack.run(new X.AddShapes(this.layer,i)),this.dispatchEvent({type:e.AFTER_PASTE,originalShapes:this.originalShapes,shapes:i})}}},{key:"delete",value:function(){var e=this.selection.getSelectedShapes();this.undoStack.run(new X.RemoveShapes(this.layer,e)),this.selection.clear()}},{key:"handleKeyDown",value:function(e,t){if(!this.selection.empty()){if(t===Zt.KeyCode.DELETE)return this.delete(),!0;if(e.ctrlKey&&t===Zt.KeyCode.c)return this.copy(),!0}if(0!==this.clipBoard.length&&e.ctrlKey&&t===Zt.KeyCode.v)return this.paste(),!0}},{key:"getName",value:function(){return"Edit2_CopyTool"+this.nameSuffix}},{key:"getNames",value:function(){return[this.getName()]}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"register",value:function(){}}])&&Jt(t.prototype,i),n&&Jt(t,n),e}();ei.BEFORE_PASTE="BEFORE_PASTE",ei.AFTER_PASTE="AFTER_PASTE";i(248);function ti(e){return(ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ii(e,t,i,n,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(n,o)}function ni(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function oi(e){return(oi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ri(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function si(e,t){return(si=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ai(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.d(t,"default",(function(){return ci}));var li=AutodeskNamespace("Autodesk.Edit2D"),hi=Autodesk.Viewing,ui=function e(t,i){ai(this,e),this.name=t,this.autoReactivate=i,this.context=null,this.tools={}},ci=function(e){function t(e,i){var n,o,r;return ai(this,t),o=this,(n=!(r=oi(t).call(this,e,i))||"object"!==ti(r)&&"function"!=typeof r?ri(o):r).undoStack=new D,n._registeredTools=new Map,n._boundOnModelAdded=n._onModelAdded.bind(ri(n)),n._boundOnModelRemoved=n._onModelRemoved.bind(ri(n)),n._boundOnSelectionChanged=n._onSelectionChanged.bind(ri(n)),n}var i,n,o,r,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&si(e,t)}(t,e),i=t,(n=[{key:"load",value:(r=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.viewer.impl.createOverlayScene("Edit2D"),e.next=3,this.viewer.loadExtension("Autodesk.Snapping");case 3:this.viewer.addEventListener(hi.MODEL_ADDED_EVENT,this._boundOnModelAdded),this.viewer.addEventListener(hi.MODEL_REMOVED_EVENT,this._boundOnModelRemoved),this.undoTool=new $t(this.undoStack),this.viewer.toolController.registerTool(this.undoTool),this.viewer.toolController.activateTool(this.undoTool.getName());case 8:case"end":return e.stop()}}),e,this)})),s=function(){var e=this,t=arguments;return new Promise((function(i,n){var o=r.apply(e,t);function s(e){ii(o,i,n,s,a,"next",e)}function a(e){ii(o,i,n,s,a,"throw",e)}s(void 0)}))},function(){return s.apply(this,arguments)})},{key:"unload",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this._registeredTools.keys()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;this.unregisterTools(r)}}catch(e){t=!0,i=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw i}}return this.viewer.toolController.deregisterTool(this.undoTool),this.undoTool=null,this.viewer.removeEventListener(hi.MODEL_ADDED_EVENT,this._boundOnModelAdded),this.viewer.removeEventListener(hi.MODEL_REMOVED_EVENT,this._boundOnModelRemoved),!0}},{key:"_onModelAdded",value:function(){var e=this;if(1===this.viewer.getVisibleModels().length){var t=!0,i=!1,n=void 0;try{for(var o,r=this._registeredTools.values()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;s.autoReactivate&&s.toolsToReactivate.forEach((function(t){return e.viewer.toolController.activateTool(t)}))}}catch(e){i=!0,n=e}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}}},{key:"_onModelRemoved",value:function(){if(0===this.viewer.getVisibleModels().length){var e=this.viewer.toolController,t=!0,i=!1,n=void 0;try{for(var o,r=this._registeredTools.values()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;s.autoReactivate&&(s.toolsToReactivate=Object.values(s.tools).map((function(e){return e.getNames()})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(t){return e.isToolActivated(t)})),s.toolsToReactivate.forEach((function(t){return e.deactivateTool(t)})))}}catch(e){i=!0,n=e}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}}},{key:"_onSelectionChanged",value:function(e){var t=e.target,i=!0,n=!1,o=void 0;try{for(var r,s=this._registeredTools.values()[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t===a.context.selection||t.empty()||a.context.selection.clear()}}catch(e){n=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(n)throw o}}}},{key:"registerDefaultTools",value:function(){this.defaultContext=this.registerTools("default")}},{key:"registerTools",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._registeredTools.get(e);if(i)return console.warn("Edit 2D tools are already registered for tool set '".concat(e,"'")),i.context;i=new ui(e,t),this._registeredTools.set(e,i);var n=i.context=new pi(this,e);n.selection.addEventListener(G.Events.SELECTION_CHANGED,this._boundOnSelectionChanged),i.tools.polygonTool=new zt(n,zt.Mode.Polygon),i.tools.polylineTool=new zt(n,zt.Mode.Polyline),i.tools.moveTool=new rt(n),i.tools.polygonEditTool=new Ut(n),i.tools.insertSymbolTool=new Xt(n),i.tools.copyTool=new ei(n);var o=this.viewer.toolController;return o.registerTool(i.tools.polygonTool),o.registerTool(i.tools.polylineTool),o.registerTool(i.tools.moveTool),o.registerTool(i.tools.polygonEditTool),o.registerTool(i.tools.insertSymbolTool),o.registerTool(i.tools.copyTool),o.activateTool(i.tools.copyTool.getName()),n}},{key:"unregisterDefaultTools",value:function(){this.unregisterTools("default"),this.defaultContext=null}},{key:"unregisterTools",value:function(e){var t=this._registeredTools.get(e);if(t){var i=this.viewer.toolController;i.deregisterTool(t.tools.polygonTool),i.deregisterTool(t.tools.polylineTool),i.deregisterTool(t.tools.moveTool),i.deregisterTool(t.tools.polygonEditTool),i.deregisterTool(t.tools.insertSymbolTool),i.deregisterTool(t.tools.copyTool),t.context.selection.removeEventListener(G.Events.SELECTION_CHANGED,this._boundOnSelectionChanged),this._registeredTools.delete(e)}}},{key:"createLayer",value:function(){var e=this.viewer.model;e&&e.is2d()||console.error("A 2D model is needed to adjust viewport");var t=e.getBoundingBox(),i=t.max.x-t.min.x,n=t.max.y-t.min.y,o=new l(i,n,this.viewer);return this.viewer.impl.overlayScenes.Edit2D.scene.add(o.scene),o}},{key:"defaultTools",get:function(){var e=this._registeredTools.get("default");return e&&e.tools}}])&&ni(i.prototype,n),o&&ni(i,o),t}(hi.Extension),pi=function e(t,i){var n=this;ai(this,e),this.toolSetName=i,this.viewer=t.viewer,this.layer=t.createLayer(),this.gizmoLayer=t.createLayer(),this.undoStack=t.undoStack,this.selection=new G(this.layer,this.undoStack),this.snapper=new ve(this.viewer,this.layer,this.gizmoLayer),this.unitHandler=new Le(this.viewer);this.viewer.addEventListener(Autodesk.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,(function(){n.layer.updateCanvasGizmos(),n.gizmoLayer.updateCanvasGizmos()}))};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Edit2D",ci),li.Shape=C,li.Polygon=_,li.Polyline=L,li.PolyBase=A,li.Circle=V,li.Style=w,li.PolygonTool=zt,li.Selection=G,li.MoveTool=rt,li.PolygonEditTool=Ut,li.InsertSymbolTool=Xt,li.Math2D=c,li.VertexGizmo=Je,li.RectangleTool=yt,li.LineTool=St,li.CopyTool=ei,li.Actions=X,li.UndoStack=D,li.UndoTool=$t,li.Edit2DContext=pi,li.CanvasGizmo=Ke,li.CanvasGizmoBase=Fe,li.ShapeLabel=We,li.AlignX=Ue,li.AlignY=Ne,li.AreaLabel=Xe,li.EdgeLabel=$e,li.UnitHandler=Ce,li.DefaultUnitHandler=Le,li.ShapeLabelRule=it,li.ShapeWrapper=z,li.SegmentTree=fe},6:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return a}));var n=100,o=.05;function r(e,t){e&&(n=e),t&&(o=t)}function s(e,t,i,r,s,a,l,h,u,c){for(var p=(c=c||1/o)*o,d=1/n,f=d*d*d,y=3*d,v=y*d,g=v+v,m=6*f,b=t-2*r+a,x=i-2*s+l,k=3*(r-a)-t+h,S=3*(s-l)-i+u,E=t,w=i,P=(r-t)*y+b*v+k*f,T=(s-i)*y+x*v+S*f,C=b*g+k*m,A=x*g+S*m,_=k*m,L=S*m,V=0,z=0|1/d-.5,M=0;M<z;M++)E+=P,w+=T,P+=C,T+=A,A+=L,C+=_,(V+=Math.sqrt(P*P+T*T))>=p&&(e.lineTo(E,w),V=0);e.lineTo(h,u)}function a(e,t,i,r,s,a,l,h){for(var u=(h=h||1/o)*o,c=1/n,p=c*c,d=t-2*r+a,f=i-2*s+l,y=t,v=i,g=2*(r-t)*c+d*p,m=2*(s-i)*c+f*p,b=2*d*p,x=2*f*p,k=0,S=0|1/c-.5,E=0;E<S;E++)y+=g,v+=m,g+=b,m+=x,(k+=Math.sqrt(g*g+m*m))>=u&&(e.lineTo(y,v),k=0);e.lineTo(a,l)}}});
//# sourceMappingURL=Edit2D.min.js.map