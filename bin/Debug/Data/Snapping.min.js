/*!
 * LMV v7.3.0
 * 
 * Copyright 2019 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.Snapping=function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=241)}({11:function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},241:function(e,t,i){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=Autodesk.Viewing,l=AutodeskNamespace("Autodesk.Viewing.Extensions.Snapping");function u(t,i){for(var r in t)t.hasOwnProperty(r)&&(e.exports[r]=t[r],i[r]=t[r])}u(i(35),l),u(i(467),l),u(i(43),l);var h=function(e){function t(e,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,a(t).call(this,e,i))}var i,r,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(t,e),i=t,(r=[{key:"load",value:function(){return this.viewer.loadExtension("Autodesk.CompGeom")}},{key:"unload",value:function(){return!0}},{key:"activate",value:function(){return!0}},{key:"deactivate",value:function(){return!1}}])&&n(i.prototype,r),c&&n(i,c),t}(c.Extension);c.theExtensionManager.registerExtension("Autodesk.Snapping",h)},35:function(e,t,i){"use strict";i.r(t),i.d(t,"sampleEllipsePoint",(function(){return r})),i.d(t,"normalizeAngle",(function(){return n})),i.d(t,"angleInsideArc",(function(){return s})),i.d(t,"nearestPointOnCircularArc",(function(){return a})),i.d(t,"intersectLines",(function(){return o}));var r=function(e,t,i,r,n,s,a,o){o=o||new THREE.Vector2;var c=s-n;c<0&&(c+=2*Math.PI),c>2*Math.PI&&(c-=2*Math.PI);var l=n+a*c;return o.x=e+i*Math.cos(l),o.y=t+r*Math.sin(l),o},n=function(e){return e/=2*Math.PI,(e-=Math.trunc(e))<0&&(e+=1),2*e*Math.PI},s=function(e,t,i){return e=n(e),(t=n(t))<(i=n(i))?e>=t&&e<=i:e>=t||e<=i},a=function(e,t,i,n,a,o){var c=(o=o||new THREE.Vector2).copy(e).sub(t).normalize(),l=Math.atan2(c.y,c.x);if(s(l,n,a))return c.multiplyScalar(i).add(t);var u=r(t.x,t.y,i,i,n,a,0),h=r(t.x,t.y,i,i,n,a,1),d=u.distanceToSquared(e)<=h.distanceToSquared(e);return o.copy(d?u:h),o},o=function(e,t,i,r,n,s){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e-5,o=(r.y-i.y)*(t.x-e.x)-(r.x-i.x)*(t.y-e.y);if(Math.abs(o)<a)return null;var c=(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x);if(c/=o,n){var l=(t.x-e.x)*(e.y-i.y)-(t.y-e.y)*(e.x-i.x);if(l/=o,c<0||c>1||l<0||l>1)return null}return(s=s||new THREE.Vector2).x=e.x+c*(t.x-e.x),s.y=e.y+c*(t.y-e.y),s}},4:function(e,t){e.exports=THREE},43:function(e,t,i){"use strict";i.r(t),i.d(t,"SnapperIndicator",(function(){return p}));var r=Autodesk.Viewing.MeasureCommon,n=r.isEqualVectors,s=r.EPSILON,a=r.SnapType,o=0,c="MeasureTool-snapper-geometries",l="MeasureTool-snapper-indicator",u=null,h=16742144,d=52224;function p(e,t){this.viewer=e,this.snapper=t,this.overlayType=o,this.previewsIntersectPoint=null,this.viewer.impl.createOverlayScene(c),this.viewer.impl.createOverlayScene(l),this.geometryMaterial=new THREE.MeshPhongMaterial({color:d,ambient:d,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),this.indicatorMaterial=new THREE.MeshBasicMaterial({color:h,ambient:h,opacity:1,transparent:!1,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})}p.prototype.constructor=p;var v=p.prototype;v.render=function(){var e=this.snapper.getSnapResult();n(this.previewsIntersectPoint,e.intersectPoint,s)||this.clearOverlay(c),this.clearOverlay(l),e.isEmpty()||((this.snapper.renderSnappedGeometry||e.hasTopology&&this.snapper.renderSnappedTopology)&&this.renderGeometry(e),this.renderIndicator(e),this.previewsIntersectPoint=e.intersectPoint.clone())},v.removeOverlay=function(e){this.viewer.impl.clearOverlay(e),this.viewer.impl.removeOverlayScene(e)},v.clearOverlay=function(e){this.removeOverlay(e),this.viewer.impl.createOverlayScene(e)},v.clearOverlays=function(){this.removeOverlay(c),this.viewer.impl.createOverlayScene(c),this.removeOverlay(l),this.viewer.impl.createOverlayScene(l),this.previewsIntersectPoint=null},v.addOverlay=function(e,t){this.viewer.impl.addOverlay(e,t)},v.drawFace=function(e,t,i){var r=new THREE.Mesh(e,t,!0);i===c&&(this.overlayType=1),this.addOverlay(i,r)},v.cylinderMesh=function(e,t,i,r){var n=(new THREE.Vector3).subVectors(t,e),s=new THREE.Matrix4;s.lookAt(e,t,(new THREE.Object3D).up),s.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-n.length(),0,0,0,0,0,1)),r=r||.5;var a=new THREE.CylinderGeometry(r,r,1,8,1,!0),o=new THREE.Mesh(a,i);return a=null,o.applyMatrix(s),o.position.x=(t.x+e.x)/2,o.position.y=(t.y+e.y)/2,o.position.z=(t.z+e.z)/2,o},v.renderGeometry=function(e){if(!n(this.previewsIntersectPoint,e.intersectPoint,s))switch(e.geomType){case a.SNAP_VERTEX:a.RASTER_PIXEL,this.drawPoint(e.geomVertex,this.geometryMaterial,c);break;case a.SNAP_EDGE:case a.SNAP_CURVEDEDGE:case a.SNAP_CIRCULARARC:case a.SNAP_MIDPOINT:this.drawLine(e.geomEdge,this.geometryMaterial,.3,c);break;case a.SNAP_FACE:case a.SNAP_CURVEDFACE:this.drawFace(e.geomFace,this.geometryMaterial,c)}},v.renderVertexIndicator=function(e){var t=r.getSnapResultPosition(e,this.viewer),i=1.2*this.setScale(t),n=this.viewer.navigation.getCameraRightVector().multiplyScalar(i),s=this.viewer.navigation.getCameraUpVector().multiplyScalar(i),a=new THREE.Geometry,o=new THREE.Vector3;o.addVectors(t,n),o.addVectors(o,s),a.vertices[0]=o.clone(),o.subVectors(t,n),o.addVectors(o,s),a.vertices[1]=o.clone(),this.drawLine(a,this.indicatorMaterial,.2,l),o.addVectors(t,n),o.subVectors(o,s),a.vertices[0]=o.clone(),o.subVectors(t,n),o.subVectors(o,s),a.vertices[1]=o.clone(),this.drawLine(a,this.indicatorMaterial,.2,l),o.subVectors(t,n),o.subVectors(o,s),a.vertices[0]=o.clone(),o.subVectors(t,n),o.addVectors(o,s),a.vertices[1]=o.clone(),this.drawLine(a,this.indicatorMaterial,.2,l),o.addVectors(t,n),o.subVectors(o,s),a.vertices[0]=o.clone(),o.addVectors(t,n),o.addVectors(o,s),a.vertices[1]=o.clone(),this.drawLine(a,this.indicatorMaterial,.2,l)},v.renderMidpointIndicator=function(e){var t=e.geomVertex,i=1.2*this.setScale(t),r=this.viewer.navigation.getCameraRightVector().multiplyScalar(i),n=this.viewer.navigation.getCameraUpVector().multiplyScalar(i),s=new THREE.Geometry,a=new THREE.Vector3;a.addVectors(t,r),a.subVectors(a,n),s.vertices[0]=a.clone(),a.subVectors(t,r),a.subVectors(a,n),s.vertices[1]=a.clone(),this.drawLine(s,this.indicatorMaterial,.2,l),a.subVectors(t,r),a.subVectors(a,n),s.vertices[0]=a.clone(),a.addVectors(t,n),s.vertices[1]=a.clone(),this.drawLine(s,this.indicatorMaterial,.2,l),a.addVectors(t,r),a.subVectors(a,n),s.vertices[0]=a.clone(),a.addVectors(t,n),s.vertices[1]=a.clone(),this.drawLine(s,this.indicatorMaterial,.2,l)},v.renderEdgeIndicator=function(e){var t=r.getSnapResultPosition(e,this.viewer),i=1.2*this.setScale(t),n=this.viewer.navigation.getCameraRightVector().multiplyScalar(i),s=this.viewer.navigation.getCameraUpVector().multiplyScalar(i),a=new THREE.Geometry,o=new THREE.Vector3;o.addVectors(t,n),o.subVectors(o,s),a.vertices[0]=o.clone(),a.vertices[1]=t.clone(),this.drawLine(a,this.indicatorMaterial,.2,l),o.subVectors(t,n),o.subVectors(o,s),a.vertices[0]=o.clone(),a.vertices[1]=t.clone(),this.drawLine(a,this.indicatorMaterial,.2,l),o.addVectors(t,s),a.vertices[0]=o.clone(),a.vertices[1]=t.clone(),this.drawLine(a,this.indicatorMaterial,.2,l)},v.renderCircleIndicator=function(e){var t=r.getSnapResultPosition(e,this.viewer);this.drawCircle(t,this.indicatorMaterial,l)},v.renderPerpendicular=function(e){var t=r.getSnapResultPosition(e,this.viewer),i=1.2*this.setScale(t),n=this.viewer.navigation.getCameraRightVector().multiplyScalar(i),s=this.viewer.navigation.getCameraUpVector().multiplyScalar(i),a=new THREE.Geometry,o=new THREE.Vector3;a.vertices[0]=t.clone(),o.subVectors(t,n),a.vertices[1]=o.clone(),this.drawLine(a,this.indicatorMaterial,.2,l),o.addVectors(t,n),o.subVectors(o,s),a.vertices[0]=o.clone(),o.subVectors(t,n),o.subVectors(o,s),a.vertices[1]=o.clone(),this.drawLine(a,this.indicatorMaterial,.2,l),o.subVectors(t,n),o.subVectors(o,s),a.vertices[0]=o.clone(),o.subVectors(t,n),o.addVectors(o,s),a.vertices[1]=o.clone(),this.drawLine(a,this.indicatorMaterial,.2,l),a.vertices[0]=t.clone(),o.subVectors(t,s),a.vertices[1]=o.clone(),this.drawLine(a,this.indicatorMaterial,.2,l)},v.renderPixelIndicator=function(e){var t=r.getSnapResultPosition(e,this.viewer),i=1.2*this.setScale(t),n=this.viewer.navigation.getCameraRightVector().multiplyScalar(i),s=this.viewer.navigation.getCameraUpVector().multiplyScalar(i),a=new THREE.Geometry,o=new THREE.Vector3;o.subVectors(t,n),o.addVectors(o,s),a.vertices[0]=o.clone(),a.vertices[1]=t.clone(),this.drawLine(a,this.indicatorMaterial,.2,l),o.addVectors(t,n),o.addVectors(o,s),a.vertices[0]=o.clone(),a.vertices[1]=t.clone(),this.drawLine(a,this.indicatorMaterial,.2,l),o.addVectors(t,n),o.subVectors(o,s),a.vertices[0]=o.clone(),a.vertices[1]=t.clone(),this.drawLine(a,this.indicatorMaterial,.2,l),o.subVectors(t,n),o.subVectors(o,s),a.vertices[0]=o.clone(),a.vertices[1]=t.clone(),this.drawLine(a,this.indicatorMaterial,.2,l)},v.renderIndicator=function(e){if(e.isPerpendicular)this.renderPerpendicular(e);else switch(e.geomType){case a.SNAP_VERTEX:case a.SNAP_INTERSECTION:this.renderVertexIndicator(e);break;case a.SNAP_MIDPOINT:this.renderMidpointIndicator(e);break;case a.SNAP_CIRCLE_CENTER:this.renderCircleIndicator(e);break;case a.SNAP_EDGE:case a.SNAP_CURVEDEDGE:this.renderEdgeIndicator(e);break;case a.SNAP_CIRCULARARC:this.viewer.model.is2d()?this.renderVertexIndicator(e):this.renderCircleIndicator(e);break;case a.SNAP_FACE:case a.SNAP_CURVEDFACE:this.renderVertexIndicator(e);break;case a.RASTER_PIXEL:this.renderPixelIndicator(e)}},v.drawLine=function(e,t,i,r){r===c&&(this.overlayType=2);for(var n=0;n<e.vertices.length;n+=2){var s=this.cylinderMesh(e.vertices[n],e.vertices[n+1],t,i);this.setEdgeScale(s),this.addOverlay(r,s)}},v.drawPoint=function(e,t,i){if(!this.viewer.model.getData().isLeaflet){u||(u=new THREE.SphereGeometry(1));var r=new THREE.Mesh(u,t);r.position.set(e.x,e.y,e.z),this.setPointScale(r),i===c&&(this.overlayType=3),this.addOverlay(i,r)}},v.drawCircle=function(e,t,i){var r=new THREE.TorusGeometry(1.2,.2,2,20),n=new THREE.Mesh(r,t);n.lookAt(this.viewer.navigation.getEyeVector().normalize()),r=null,n.position.set(e.x,e.y,e.z),this.setCircleScale(n),this.addOverlay(i,n)},v.setScale=function(e){var t=this.viewer.navigation,i=t.getCamera(),r=t.getPosition(),n=e.clone(),s=i.isPerspective?n.sub(r).length():t.getEyeVector().length(),a=t.getVerticalFov();return 5*(2*s*Math.tan(THREE.Math.degToRad(.5*a)))/t.getScreenViewport().height},v.setPointScale=function(e){var t=this.setScale(e.position);e.scale.x=t,e.scale.y=t,e.scale.z=t},v.setCircleScale=function(e){var t=this.setScale(e.position);e.scale.x=t,e.scale.y=t},v.setEdgeScale=function(e){var t=this.setScale(e.position);e.scale.x=t,e.scale.z=t},v.updatePointScale=function(e){if(3==this.overlayType){var t=this.viewer.impl.overlayScenes[e];if(t)for(var i=t.scene,r=0;r<i.children.length;r++){var n=i.children[r];n&&this.setPointScale(n)}}},v.updateEdgeScale=function(e){if(2==this.overlayType){var t=this.viewer.impl.overlayScenes[e];if(t)for(var i=t.scene,r=0;r<i.children.length;r++){var n=i.children[r];n&&this.setEdgeScale(n)}}},v.onCameraChange=function(){this.updatePointScale(c),this.updateEdgeScale(c),this.render()},v.destroy=function(){this.removeOverlay(c),this.removeOverlay(l),u&&(u.dispose(),u=null)}},44:function(e,t,i){"use strict";(function(e){function r(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:e}i.d(t,"a",(function(){return l}));var n="undefined"!=typeof navigator,s=n&&!!navigator.userAgent.match(/Edge|Trident\/7\./);"undefined"!=typeof window&&s&&function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=window.CustomEvent.prototype,window.CustomEvent=e}(),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){if(!t||t>this.byteLength?t=this.byteLength:t<0&&(t=this.byteLength+t)<0&&(t=0),e<0&&(e=this.byteLength+e)<0&&(e=0),t<=e)return new ArrayBuffer;for(var i=t-e,r=new Uint8Array(this,e,i),n=new Uint8Array(i),s=0;s<i;s++)n[s]=r[s];return n.buffer}),Math.log2=Math.log2||function(e){return Math.log(e)/Math.LN2},"undefined"!=typeof window&&(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);var a=n&&/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase());function o(){return a}var c=n&&-1!==navigator.userAgent.toLowerCase().indexOf("android");function l(){return!!n&&(o()||c)}!function(){var e=r();e.performance||(e.performance=Date)}(),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},String.prototype.repeat=String.prototype.repeat||function(e){if(e<1)return"";for(var t="",i=this.valueOf();e>1;)1&e&&(t+=i),e>>=1,i+=i;return t+i},Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{enumerable:!1,value:function(e,t,i){t=void 0===t?0:t,i=void 0===i?this.length:i;for(var r=t;r<i;++r)this[r]=e}}),Int32Array.prototype.lastIndexOf=Int32Array.prototype.lastIndexOf||function(e,t){return Array.prototype.lastIndexOf.call(this,e,t)},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,value:function(e,t){for(var i=this.length,r=0;r<i;++r){var n=this[r];if(e.call(t,n,r,this))return n}}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=n[s])}return i},writable:!0,configurable:!0}),"undefined"==typeof window||!s&&!o()||HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,i){var r=this;setTimeout((function(){for(var n=atob(r.toDataURL(t,i).split(",")[1]),s=n.length,a=new Uint8Array(s),o=0;o<s;o++)a[o]=n.charCodeAt(o);e(new Blob([a],{type:t||"image/png"}))}))}}),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(e,t){if(t=void 0!==t?t:this.length,"[object Array]"===Object.prototype.toString.call(this))return _slice.call(this,e,t);var i,r,n=[],s=this.length,a=e||0;a=a>=0?a:Math.max(0,s+a);var o="number"==typeof t?Math.min(t,s):s;if(t<0&&(o=s+t),(r=o-a)>0)if(n=new Array(r),this.charAt)for(i=0;i<r;i++)n[i]=this.charAt(a+i);else for(i=0;i<r;i++)n[i]=this[a+i];return n})}).call(this,i(11))},467:function(e,t,i){"use strict";i.r(t);var r=i(43),n=i(44),s=i(4),a=2*Math.PI;function o(e,t){this.vb=e.vb.buffer,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.vbs=new Uint16Array(this.vb),this.ib=e.ib,this.stride=e.vbstride,this.vcount=this.vbf.length/this.stride,this.useInstancing=!!t,this.useCompactBuffers=e.unpackXform,this.texData=this.useCompactBuffers&&e.tIdColor&&e.tIdColor.image&&e.tIdColor.image.data&&new Uint32Array(e.tIdColor.image.data.buffer)}function c(e){this.bounds=e,this.point=new s.Vector4,this.point.z=0,this.point.w=1}o.prototype.getDbIdAt=function(e){return this.texData?this.texData[this.vbs[e*this.stride*2+7]]:this.vbi[e*this.stride+7]},o.prototype.getColorAt=function(e){return this.texData?this.texData[this.vbs[e*this.stride*2+6]]:this.vbi[e*this.stride+6]},o.prototype.getVertexFlagsAt=function(e){return this.texData?this.vbi[e*this.stride+4]:this.vbi[e*this.stride+8]},o.prototype.getLayerIndexAt=function(e){return this.texData?65535&this.vbi[e*this.stride+5]:65535&this.vbi[e*this.stride+9]},o.prototype.getViewportIndexAt=function(e){return this.texData?this.vbi[e*this.stride+5]>>16&65535:this.vbi[e*this.stride+9]>>16&65535},o.prototype.decodeLineAt=function(e,t,i,r){if(r.onLineSegment){if(this.useCompactBuffers)var n=this.stride*e*2,s=this.useCompactBuffers.x*this.vbs[n]/65535+this.useCompactBuffers.z,o=this.useCompactBuffers.y*this.vbs[n+1]/65535+this.useCompactBuffers.w,c=this.vbs[n+2]/65535*a-Math.PI,l=this.vbs[n+3]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y),u=this.vbs[n+4]/32767*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y)*2;else{var h=this.stride*e;s=this.vbf[h],o=this.vbf[h+1],c=this.vbf[h+2]*a-Math.PI,l=this.vbf[h+3],u=2*this.vbf[h+4]}var d=s+l*Math.cos(c),p=o+l*Math.sin(c);r.onLineSegment(s,o,d,p,i,u)}},o.prototype.decodeCircularArcAt=function(e,t,i,r){if(r.onCircularArc){if(this.useCompactBuffers)var n=this.stride*e*2,s=this.useCompactBuffers.x*this.vbs[n]/65535+this.useCompactBuffers.z,o=this.useCompactBuffers.y*this.vbs[n+1]/65535+this.useCompactBuffers.w,c=this.vbs[n+2]/65535*a,l=this.vbs[n+3]/65535*a,u=this.vbs[n+5]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y);else{var h=this.stride*e;s=this.vbf[h],o=this.vbf[h+1],c=this.vbf[h+2]*a,l=this.vbf[h+3]*a,u=this.vbf[h+5]}r.onCircularArc(s,o,c,l,u,i)}},o.prototype.decodeEllipticalArcAt=function(e,t,i,r){if(r.onEllipticalArc){var n=this.stride*e,s=this.vbf[n],o=this.vbf[n+1],c=this.vbf[n+2]*a,l=this.vbf[n+3]*a,u=this.vbf[n+5],h=this.vbf[n+10],d=this.vbf[n+11];r.onEllipticalArc(s,o,c,l,u,h,d,i)}},o.prototype.decodeTexQuadAt=function(e,t,i,r){if(r.onTexQuad){if(this.useCompactBuffers)var n=this.stride*e*2,s=this.useCompactBuffers.x*this.vbs[n]/65535+this.useCompactBuffers.z,o=this.useCompactBuffers.y*this.vbs[n+1]/65535+this.useCompactBuffers.w,c=this.vbs[n+2]/65535*a,l=this.vbs[n+3]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y),u=this.vbs[n+4]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y);else{var h=this.stride*e;s=this.vbf[h],o=this.vbf[h+1],c=this.vbf[h+2]*a,l=this.vbf[h+3],u=this.vbf[h+4]}r.onTexQuad(s,o,l,u,c,i)}},o.prototype.decodeOneTriangleAt=function(e,t,i,r){if(r.onOneTriangle){if(this.useCompactBuffers)var n=this.stride*e*2,s=this.useCompactBuffers.x*this.vbs[n]/65535+this.useCompactBuffers.z,a=this.useCompactBuffers.y*this.vbs[n+1]/65535+this.useCompactBuffers.w,o=this.useCompactBuffers.x*this.vbs[n+2]/65535+this.useCompactBuffers.z,c=this.useCompactBuffers.y*this.vbs[n+3]/65535+this.useCompactBuffers.w,l=this.useCompactBuffers.x*this.vbs[n+4]/65535+this.useCompactBuffers.z,u=this.useCompactBuffers.y*this.vbs[n+5]/65535+this.useCompactBuffers.w;else{var h=this.stride*e;s=this.vbf[h],a=this.vbf[h+1],o=this.vbf[h+2],c=this.vbf[h+3],l=this.vbf[h+4],u=this.vbf[h+5]}r.onOneTriangle(s,a,o,c,l,u,i)}},o.prototype.decodeTriangleIndexed=function(e,t,i,r,n,s){if(s.onOneTriangle){if(this.useCompactBuffers){var a=this.stride*e*2,o=this.useCompactBuffers.x*this.vbs[a]/65535+this.useCompactBuffers.z,c=this.useCompactBuffers.y*this.vbs[a+1]/65535+this.useCompactBuffers.w;a=this.stride*t*2;var l=this.useCompactBuffers.x*this.vbs[a]/65535+this.useCompactBuffers.z,u=this.useCompactBuffers.y*this.vbs[a+1]/65535+this.useCompactBuffers.w;a=this.stride*i*2;var h=this.useCompactBuffers.x*this.vbs[a]/65535+this.useCompactBuffers.z,d=this.useCompactBuffers.y*this.vbs[a+1]/65535+this.useCompactBuffers.w}else{var p=this.stride*e;o=this.vbf[p],c=this.vbf[p+1];p=this.stride*t;l=this.vbf[p],u=this.vbf[p+1];p=this.stride*i;h=this.vbf[p],d=this.vbf[p+1]}s.onOneTriangle(o,c,l,u,h,d,n)}},o.prototype.enumGeomsForObject=function(e,t){if(this.useInstancing)for(var i=0;i<this.vcount;){var r=this.getVertexFlagsAt(i)>>8&255,n=this.getLayerIndexAt(i),s=this.getViewportIndexAt(i);if(o=this.getDbIdAt(i)===e)switch(r){case 1:this.decodeLineAt(i,n,s,t);break;case 2:this.decodeCircularArcAt(i,n,s,t);break;case 3:this.decodeEllipticalArcAt(i,n,s,t);break;case 4:this.decodeTexQuadAt(i,n,s,t);break;case 5:this.decodeOneTriangleAt(i,n,s,t)}i+=1}else for(i=0;i<this.ib.length;){var a=this.ib[i],o=(r=this.getVertexFlagsAt(a)>>8&255,n=this.getLayerIndexAt(a),s=this.getViewportIndexAt(a),this.getDbIdAt(a)===e);if(0===r)o&&this.decodeTriangleIndexed(this.ib[i],this.ib[i+1],this.ib[i+2],n,s,t),i+=3;else{if(o)switch(r){case 1:this.decodeLineAt(a,n,s,t);break;case 2:this.decodeCircularArcAt(a,n,s,t);break;case 3:this.decodeEllipticalArcAt(a,n,s,t);break;case 4:this.decodeTexQuadAt(a,n,s,t);break;case 5:this.decodeOneTriangleAt(a,n,s,t)}i+=6}}},o.prototype.enumGeomsForVisibleLayer=function(e,t){this.enumGeoms((function(t,i,r){return!e||0!==i&&-1!==e.indexOf(i)}),t)},o.prototype.enumGeoms=function(e,t){if(this.useInstancing)for(var i=0;i<this.vcount;){var r=this.getVertexFlagsAt(i)>>8&255,n=this.getLayerIndexAt(i),s=this.getViewportIndexAt(i),a=this.getDbIdAt(i);if(c=!e||e(a,n,s))switch(r){case 1:this.decodeLineAt(i,n,s,t);break;case 2:this.decodeCircularArcAt(i,n,s,t);break;case 3:this.decodeEllipticalArcAt(i,n,s,t);break;case 4:this.decodeTexQuadAt(i,n,s,t);break;case 5:this.decodeOneTriangleAt(i,n,s,t)}i+=1}else for(i=0;i<this.ib.length;){var o=this.ib[i],c=(r=this.getVertexFlagsAt(o)>>8&255,n=this.getLayerIndexAt(o),s=this.getViewportIndexAt(o),a=this.getDbIdAt(o),!e||e(a,n,s));if(0===r)c&&this.decodeTriangleIndexed(this.ib[i],this.ib[i+1],this.ib[i+2],n,s,t),i+=3;else{if(c)switch(r){case 1:this.decodeLineAt(o,n,s,t);break;case 2:this.decodeCircularArcAt(o,n,s,t);break;case 3:this.decodeEllipticalArcAt(o,n,s,t);break;case 4:this.decodeTexQuadAt(o,n,s,t);break;case 5:this.decodeOneTriangleAt(o,n,s,t)}i+=6}}},c.prototype.onVertex=function(e,t,i){this.point.x=e,this.point.y=t,this.bounds.expandByPoint(this.point)},c.prototype.onLineSegment=function(e,t,i,r,n){this.onVertex(e,t),this.onVertex(i,r)},c.prototype.onCircularArc=function(e,t,i,r,n,s){this.onEllipticalArc(e,t,i,r,n,n,0,s)},c.prototype.onEllipticalArc=function(e,t,i,r,n,s,a,o){0==a?i<=0&&r>=2*Math.PI-1e-5?this.onTexQuad(e,t,2*n,2*s,a,o):(this.point.x=e+Math.cos(i)*n,this.point.y=t+Math.sin(i)*s,this.bounds.expandByPoint(this.point),this.point.x=e+Math.cos(r)*n,this.point.y=t+Math.sin(r)*s,this.bounds.expandByPoint(this.point),i>r&&(this.point.x=e+n,this.point.y=t,this.bounds.expandByPoint(this.point),i-=2*Math.PI),i<.5*Math.PI&&r>.5*Math.PI&&(this.point.x=e,this.point.y=t+s,this.bounds.expandByPoint(this.point)),i<Math.PI&&r>Math.PI&&(this.point.x=e-n,this.point.y=t,this.bounds.expandByPoint(this.point)),i<1.5*Math.PI&&r>1.5*Math.PI&&(this.point.x=e,this.point.y=t-s,this.bounds.expandByPoint(this.point))):this.onTexQuad(e,t,2*n,2*s,a,o)},c.prototype.onTexQuad=function(e,t,i,r,n,a){var o=.5*i,c=.5*i;if(0==n)this.onVertex(e-o,t-c),this.onVertex(e+o,t+c);else{var l=new s.Matrix4,u=new s.Matrix4;l.makeRotationZ(n),u.makeTranslation(e,t,0),u.multiply(l);for(var h=0;h<4;h++)this.point.x=h%2==1?o:-o,this.point.y=h>=2?c:-c,this.point.applyMatrix4(u),this.bounds.expandByPoint(this.point)}},c.prototype.onOneTriangle=function(e,t,i,r,n,s,a){this.onVertex(e,t),this.onVertex(i,r),this.onVertex(n,s)};var l=i(35);function u(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}i.d(t,"Snapper",(function(){return T}));var h=Autodesk.Viewing.MeasureCommon,d=h.EPSILON,p=h.SnapType,v=h.SnapResult,f=.001;function g(e,t){return Math.abs(e-t)<=f}function y(e,t){return Math.abs(e.x-t.x)<=f&&Math.abs(e.y-t.y)<=f&&Math.abs(e.z-t.z)<=f}function m(e,t,i){var r,n,s=new THREE.Vector3,a=new THREE.Vector3;return s.subVectors(t,e),a.subVectors(i,t),n=s.dot(a),s.subVectors(i,t),(n=-n/s.dot(s))<0?r=e.distanceTo(t):n>1?r=e.distanceTo(i):(s.subVectors(e,t),a.subVectors(e,i),s.cross(a),a.subVectors(i,t),r=Math.sqrt(s.dot(s))/Math.sqrt(a.dot(a))),r}var E={Unknown:0,Line:1,CircularArc:2,EllipticalArc:3},b=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=E.Unknown,this.viewportId=t,this.distance=0,this.lineStart=null,this.lineEnd=null,this.radius=0,this.radiusX=0,this.radiusY=0,this.center=null,this.startAngle=0,this.endAngle=0}var t,i,r;return t=e,(i=[{key:"fromLine",value:function(e,t){return this.type=E.Line,this.lineStart=e.clone(),this.lineEnd=t.clone(),this}},{key:"fromCircularArc",value:function(e,t,i,r){return this.type=E.CircularArc,this.center=e.clone(),this.radius=t,this.start=i,this.end=r,this}},{key:"fromEllipticalArc",value:function(e,t,i,r,n){return this.type=E.EllipticalArc,this.center=e.clone(),this.radiusX=t,this.radiusY=i,this.start=r,this.end=n,this}},{key:"isLine",value:function(){return this.type===E.Line}},{key:"isCircularArc",value:function(){return this.type===E.CirularArc}},{key:"isEllipticalArc",value:function(){return this.type===E.EllipticalArc}},{key:"getIntersection",value:function(e,t){if(this.isLine()&&e.isLine())return Object(l.intersectLines)(this.lineStart,this.lineEnd,e.lineStart,e.lineEnd,!1,t)}}])&&u(t.prototype,i),r&&u(t,r),e}(),w=function(e,t,i){if(e.sort((function(e,t){return e.distance-t.distance})),e.length<2)return null;for(var r={viewportId:e[0].viewportId,snapPoint:new THREE.Vector3(0,0,t.z)},n=e[0],s=1;s<e.length;s++){var a=e[s];if(n.getIntersection(a,r.snapPoint))if(THREE.Vector2.prototype.distanceTo.call(r.snapPoint,t)<i)return r}return null};function T(e,t){var i,s=new v,a=e,c=t||{};i=c.markupMode?["snapper-markup"]:["snapper"];var u=!1,h=Number.MAX_VALUE,E=null,T=!1,x=!1,A=!1,V=null,R=!1;this.indicator=new r.SnapperIndicator(e,this),this.markupMode=c.markupMode,this.renderSnappedGeometry=c.renderSnappedGeometry,this.renderSnappedTopology=c.renderSnappedTopology,this.isActive=function(){return u},this.getNames=function(){return i},this.getName=function(){return i[0]},this.getPriority=function(){return 60},this.activate=function(){u=!0,this.indicator||(this.indicator=new r.SnapperIndicator(e,this))},this.deactivate=function(){u=!1,R=!1,this.indicator&&(this.indicator.destroy(),this.indicator=null)},this.copyResults=function(e){s.copyTo(e)},this.getEdge=function(){return s.geomEdge},this.getVertex=function(){return s.geomVertex},this.getGeometry=function(){return s.getGeometry()},this.getGeometryType=function(){return s.geomType},this.getIntersectPoint=function(){return s.intersectPoint},this.getSnapResult=function(){return s},this.isSnapped=function(){return A},this.clearSnapped=function(){s.clear(),A=!1},this.setViewportId=function(e){V=e},this.setSnapToPixel=function(e){R=e},this.snapping3D=function(e){if(s.snapNode=e.dbId,s.intersectPoint=e.intersectPoint,e.model){var t,i=e.face;t=e.fragId&&void 0!==e.fragId.length?e.fragId:[e.fragId],s.hasTopology=e.model.hasTopology(),s.hasTopology?this.snapping3DwithTopology(i,t,e.model):this.snapping3DtoMesh(i,t,e.model)}},this.snapping3DwithTopology=function(e,t,i){s.snapNode&&(t=[],i.getData().instanceTree.enumNodeFragments(s.snapNode,(function(e){t.push(e)}),!0)),s.geomFace=s.geomEdge=s.geomVertex=null,h=Number.MAX_VALUE;for(var r=0;r<t.length;++r){var n=t[r],o=a.impl.getRenderProxy(i,n),l=o.geometry,u=i.getTopoIndex(n),d=i.getTopology(u),v=d.faces,f=d.edges;if(!s.geomFace){s.geomFace=this.faceSnappingWithTopology(e,l,v,o),s.geomFace&&(s.geomFace.fragId=n);var g=(new THREE.Matrix3).getNormalMatrix(o.matrixWorld);s.faceNormal=e.normal.applyMatrix3(g).normalize()}this.edgeSnappingWithTopology(s.intersectPoint,l,f,o)}if(s.geomVertex=this.vertexSnappingWithTopology(s.geomEdge,s.intersectPoint),s.geomFace){if(s.radius=this.setDetectRadius(s.intersectPoint),(c.forceSnapVertices||E<s.radius)&&s.geomVertex)s.geomType=p.SNAP_VERTEX;else if((c.forceSnapEdges||h<s.radius)&&s.geomEdge){var y=this.edgeIsCircle(s.geomEdge);y?(s.circularArcCenter=y,s.circularArcRadius=y.distanceTo(s.geomEdge.vertices[0]),s.geomEdge.center=s.circularArcCenter,s.geomEdge.radius=s.circularArcRadius,s.geomType=p.SNAP_CIRCULARARC):this.edgeIsCurved(s.geomEdge)?s.geomType=p.SNAP_CURVEDEDGE:s.geomType=p.SNAP_EDGE}else this.faceIsCurved(s.geomFace)?s.geomType=p.SNAP_CURVEDFACE:s.geomType=p.SNAP_FACE;A=!0}},this.snapping3DtoMesh=function(e,t,i){for(var r=0;r<t.length;++r){var n=t[r],o=a.impl.getRenderProxy(i,n),l=o.geometry;if(s.geomFace=this.faceSnapping(e,l),s.geomFace){s.geomFace.applyMatrix(o.matrixWorld),s.geomEdge=this.edgeSnapping(s.geomFace,s.intersectPoint),s.geomVertex=this.vertexSnapping(s.geomEdge,s.intersectPoint);var u=(new THREE.Matrix3).getNormalMatrix(o.matrixWorld);s.faceNormal=e.normal.applyMatrix3(u).normalize(),s.radius=this.setDetectRadius(s.intersectPoint),c.forceSnapVertices||E<s.radius?s.geomType=p.SNAP_VERTEX:c.forceSnapEdges||h<s.radius?s.geomType=p.SNAP_EDGE:s.geomType=p.SNAP_FACE,A=!0;break}}},this.faceSnappingWithTopology=function(e,t,i,r){var n=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Geometry,c=t.attributes;if(void 0!==c.index){for(var l=t.vb?t.vb:c.position.array,u=t.vb?t.vbstride:3,h=0;h<i.length;h++){for(var d=i[h].indexList,p=i[h].id,v=0;v<d.length;v+=3)if(e.a===d[v]){if(e.b===d[v+1]&&e.c===d[v+2]||e.b===d[v+2]&&e.c===d[v+1])break}else if(e.a===d[v+1]){if(e.b===d[v]&&e.c===d[v+2]||e.b===d[v+2]&&e.c===d[v])break}else if(e.a===d[v+2]&&(e.b===d[v]&&e.c===d[v+1]||e.b===d[v+1]&&e.c===d[v]))break;if(v<d.length)break}if(h<i.length)for(v=0;v<d.length;v+=3){n.set(l[d[v]*u],l[d[v]*u+1],l[d[v]*u+2]),s.set(l[d[v+1]*u],l[d[v+1]*u+1],l[d[v+1]*u+2]),a.set(l[d[v+2]*u],l[d[v+2]*u+1],l[d[v+2]*u+2]);var f=o.vertices.length;o.vertices.push(n.clone()),o.vertices.push(s.clone()),o.vertices.push(a.clone()),o.faces.push(new THREE.Face3(f,f+1,f+2))}}return o.vertices.length>0?(o.faceId=p,o.applyMatrix(r.matrixWorld),o):null},this.faceSnapping=function(e,t){var i=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Vector3,s=new THREE.Geometry,a=t.attributes;if(void 0!==a.index){var o=a.index.array||t.ib,c=t.vb?t.vb:a.position.array,l=t.vb?t.vbstride:3,u=t.offsets;u&&0!==u.length||(u=[{start:0,count:o.length,index:0}]);for(var h=0;h<u.length;++h)for(var d=u[h].start,p=u[h].count,v=u[h].index,f=d;f<d+p;f+=3){var m=v+o[f],E=v+o[f+1],b=v+o[f+2];i.set(c[m*l],c[m*l+1],c[m*l+2]),r.set(c[E*l],c[E*l+1],c[E*l+2]),n.set(c[b*l],c[b*l+1],c[b*l+2]);var w=THREE.Triangle.normal(i,r,n),T=new THREE.Vector3;if(T.set(c[e.a*l],c[e.a*l+1],c[e.a*l+2]),y(w,e.normal)&&g(w.dot(i),e.normal.dot(T))){var x=s.vertices.length;s.vertices.push(i.clone()),s.vertices.push(r.clone()),s.vertices.push(n.clone()),s.faces.push(new THREE.Face3(x,x+1,x+2))}}}return s.vertices.length>0?this.getTrianglesOnSameFace(s,e,c,l):null},this.getTrianglesOnSameFace=function(e,t,i,r){var n=!1,s=e.vertices.slice(),a=new THREE.Vector3;a.set(i[t.a*r],i[t.a*r+1],i[t.a*r+2]);var o=new THREE.Vector3;o.set(i[t.b*r],i[t.b*r+1],i[t.b*r+2]);var c=new THREE.Vector3;c.set(i[t.c*r],i[t.c*r+1],i[t.c*r+2]);var l=new THREE.Geometry;l.vertices.push(a),l.vertices.push(o),l.vertices.push(c),l.faces.push(new THREE.Face3(0,1,2));var u=[];do{u=[];for(var h=0;h<s.length;h+=3)if(s[h].equals(a)&&s[h+1].equals(o)&&s[h+2].equals(c))n=!0,u.push(h);else for(var d=0;d<l.vertices.length;d+=3)if(this.trianglesSharedEdge(s[h],s[h+1],s[h+2],l.vertices[d],l.vertices[d+1],l.vertices[d+2])){var p=l.vertices.length;l.vertices.push(s[h].clone()),l.vertices.push(s[h+1].clone()),l.vertices.push(s[h+2].clone()),l.faces.push(new THREE.Face3(p,p+1,p+2)),u.push(h);break}for(var v=u.length-1;v>=0;--v)s.splice(u[v],3)}while(u.length>0);return n?l:null},this.trianglesSharedEdge=function(e,t,i,r,n,s){var a=!1,o=!1,c=!1;return(e.equals(r)||e.equals(n)||e.equals(s))&&(a=!0),(t.equals(r)||t.equals(n)||t.equals(s))&&(o=!0),(i.equals(r)||i.equals(n)||i.equals(s))&&(c=!0),!!(a&o||a&c||o&c)},this.edgeSnappingWithTopology=function(e,t,i,r){var n,a=new THREE.Geometry,o=Number.MAX_VALUE,c=new THREE.Vector3,l=new THREE.Vector3,u=t.attributes;if(void 0!==u.index&&null!=i){for(var d=t.vb?t.vb:u.position.array,p=t.vb?t.vbstride:3,v=0;v<i.length;v++)for(var f=i[v].indexList,g=0;g<f.length-1;g++){c.set(d[f[g]*p],d[f[g]*p+1],d[f[g]*p+2]),l.set(d[f[g+1]*p],d[f[g+1]*p+1],d[f[g+1]*p+2]),c.applyMatrix4(r.matrixWorld),l.applyMatrix4(r.matrixWorld);var y=m(e,c,l);y<o&&(o=y,n=v)}if(n){f=i[n].indexList;for(var E=0;E<f.length-1;E++)a.vertices.push(new THREE.Vector3(d[f[E]*p],d[f[E]*p+1],d[f[E]*p+2])),a.vertices.push(new THREE.Vector3(d[f[E+1]*p],d[f[E+1]*p+1],d[f[E+1]*p+2]))}}h>=o&&a.vertices.length>0&&(h=o,a.applyMatrix(r.matrixWorld),s.geomEdge=a)},this.edgeSnapping=function(e,t){for(var i=new THREE.Geometry,r=!0,n=!0,s=!0,a=0;a<e.vertices.length;a+=3){for(var o=0;o<e.vertices.length;o+=3)a!==o&&((e.vertices[a].equals(e.vertices[o])||e.vertices[a].equals(e.vertices[o+1])||e.vertices[a].equals(e.vertices[o+2]))&&(e.vertices[a+1].equals(e.vertices[o])||e.vertices[a+1].equals(e.vertices[o+1])||e.vertices[a+1].equals(e.vertices[o+2]))&&(r=!1),(e.vertices[a].equals(e.vertices[o])||e.vertices[a].equals(e.vertices[o+1])||e.vertices[a].equals(e.vertices[o+2]))&&(e.vertices[a+2].equals(e.vertices[o])||e.vertices[a+2].equals(e.vertices[o+1])||e.vertices[a+2].equals(e.vertices[o+2]))&&(n=!1),(e.vertices[a+1].equals(e.vertices[o])||e.vertices[a+1].equals(e.vertices[o+1])||e.vertices[a+1].equals(e.vertices[o+2]))&&(e.vertices[a+2].equals(e.vertices[o])||e.vertices[a+2].equals(e.vertices[o+1])||e.vertices[a+2].equals(e.vertices[o+2]))&&(s=!1));r&&(i.vertices.push(e.vertices[a].clone()),i.vertices.push(e.vertices[a+1].clone())),n&&(i.vertices.push(e.vertices[a].clone()),i.vertices.push(e.vertices[a+2].clone())),s&&(i.vertices.push(e.vertices[a+1].clone()),i.vertices.push(e.vertices[a+2].clone())),r=!0,n=!0,s=!0}for(var c,l=new THREE.Geometry,u=Number.MAX_VALUE,d=0;d<i.vertices.length;d+=2){var p=m(t,i.vertices[d],i.vertices[d+1]);p<u&&(u=p,c=d)}return l.vertices.push(i.vertices[c].clone()),l.vertices.push(i.vertices[c+1].clone()),l.vertices=this.getConnectedLineSegmentsOnSameLine(i,l.vertices),h=u,l},this.getConnectedLineSegmentsOnSameLine=function(e,t){var i,r,n=e.vertices.slice(),s=t[0],a=t[1],o=[];do{o=[];for(var c=0;c<n.length;c+=2)if(!n[c].equals(s)||!n[c+1].equals(a))for(var l=0;l<t.length;l+=2)if(n[c].equals(t[l])||n[c+1].equals(t[l])||n[c].equals(t[l+1])||n[c+1].equals(t[l+1])){var u=new THREE.Vector3,h=new THREE.Vector3;if(u.subVectors(t[l],t[l+1]),u.normalize(),h.subVectors(n[c],n[c+1]),h.normalize(),y(u,h)||(i=u,r=h,Math.abs(i.x+r.x)<=f&&Math.abs(i.y+r.y)<=f&&Math.abs(i.z+r.z)<=f)){o.push(c);break}}for(var d=o.length-1;d>=0;--d)t.push(n[o[d]]),t.push(n[o[d]+1]),n.splice(o[d],2)}while(o.length>0);return t},this.vertexSnappingWithTopology=function(e,t){var i=Number.MAX_VALUE,r=new THREE.Vector3;if(e&&e.vertices.length>1){var n=t.distanceTo(e.vertices[0]),s=t.distanceTo(e.vertices[e.vertices.length-1]);n<=s?(i=n,r=e.vertices[0].clone()):(i=s,r=e.vertices[e.vertices.length-1].clone())}return E=i,r},this.vertexSnapping=function(e,t){for(var i=Number.MAX_VALUE,r=new THREE.Vector3,n=0;n<e.vertices.length;++n){var s=t.distanceTo(e.vertices[n]);s<i-f&&(i=s,r=e.vertices[n].clone())}return E=i,r},this.edgeIsCircle=function(e){var t=e.vertices;if(t.length<8)return!1;if(t[0].equals(t[t.length-1])){for(var i=new THREE.Vector3(0,0,0),r=0;r<t.length;r+=2)i.add(t[r]);i.divideScalar(t.length/2);var n=i.distanceTo(t[0]);for(r=0;r<t.length;r+=2)if(!(Math.abs(i.distanceTo(t[r])-n)<=f))return!1;return i}return!1},this.edgeIsCurved=function(e){var t=e.vertices;if(t.length<=2)return!1;if(t[0].equals(t[t.length-1]))return!0;var i=new THREE.Vector3;i.subVectors(t[0],t[1]);for(var r=new THREE.Vector3,n=2;n<t.length;n+=2)if(r.subVectors(t[n],t[n+1]),!y(i,r))return!0;return!1},this.faceIsCurved=function(e){var t=e.vertices,i=e.faces;if(i.length<=1)return!1;for(var r=THREE.Triangle.normal(t[i[0].a],t[i[0].b],t[i[0].c]),n=t[i[0].a],s=1;s<i.length;s++){var a=THREE.Triangle.normal(t[i[s].a],t[i[s].b],t[i[s].c]),o=t[i[s].a];if(!y(r,a)||!g(r.dot(n),a.dot(o)))return!0}return!1},this.angleVector2=function(e){return e.x>0&&e.y>=0?Math.atan(e.y/e.x):e.x>=0&&e.y<0?Math.atan(e.y/e.x)+2*Math.PI:e.x<0&&e.y<=0?Math.atan(e.y/e.x)+Math.PI:e.x<=0&&e.y>0?Math.atan(e.y/e.x)+Math.PI:null};function S(e,t,i){this.viewer=e,this.snapper=t,this.lineGeom=new THREE.Geometry,this.circularArc=null,this.circularArcCenter,this.circularArcRadius,this.ellipticalArc=null,this.ellipticalArcCenter,this.minDist=Number.MAX_VALUE,this.vpIdLine=null,this.vpIdCircular=null,this.vpIdElliptical=null,this.detectRadius=i,this.snapCandidates=[]}S.prototype.onLineSegment=function(e,t,i,r,n){var s=this.snapper.getIntersectPoint(),a=this.lineGeom.vertices,o=new THREE.Vector3(e,t,s.z),c=new THREE.Vector3(i,r,s.z),l=m(s,o,c);l>this.detectRadius||(this.snapCandidates.push(new b(n,l).fromLine(o,c)),l<this.minDist&&(a.splice(0,2,o,c),this.minDist=l,this.vpIdLine=n))},S.prototype.onCircularArc=function(e,t,i,r,n,s){var a=this.snapper.getIntersectPoint(),o=new THREE.Vector2(a.x,a.y),c=new THREE.Vector2(e,t);o.sub(c);var u=Object(l.nearestPointOnCircularArc)(a,c,n,i,r).distanceTo(a);if(this.snapCandidates.push(new b(s,u).fromCircularArc(c,n,i,r)),!(u>this.detectRadius)){var h=this.snapper.angleVector2(o);if(r>i&&h>=i&&h<=r)var d=new THREE.CircleGeometry(n,100,i,r-i);else{if(!(r<i&&(h>=i||h<=r)))return;d=new THREE.CircleGeometry(n,100,i,2*Math.PI-i+r)}d.vertices.splice(0,1),d.applyMatrix((new THREE.Matrix4).makeTranslation(e,t,a.z)),this.circularArc=d,this.circularArcCenter=new THREE.Vector3(e,t,a.z),this.circularArcRadius=n,this.vpIdCircular=s}},S.prototype.onEllipticalArc=function(e,t,i,r,n,s,a,o){var c=this.snapper.getIntersectPoint(),u=new THREE.Vector2(c.x,c.y),h=n-this.detectRadius,d=s-this.detectRadius,p=n+this.detectRadius,v=s+this.detectRadius,f=(u.x-e)*(u.x-e)/(h*h)+(u.y-t)*(u.y-t)/(d*d),y=(u.x-e)*(u.x-e)/(p*p)+(u.y-t)*(u.y-t)/(v*v),m=new THREE.Vector2(e,t);u.sub(m),u.x*=s,u.y*=n;var E=this.snapper.angleVector2(u);if(r>2*Math.PI&&(r=2*Math.PI),f>=1&&y<=1&&(r>i&&E>=i&&E<=r||r<i&&(E>=i||E<=r))){var w=function(e,t,i,r,n,s,a){for(var o=new THREE.Geometry,c=0;c<a;c++){var u=new THREE.Vector3(0,0,0);Object(l.sampleEllipsePoint)(e,t,i,r,n,s,c/(a-1),u),o.vertices.push(u)}return o}(e,t,n,s,i,r,50);g(r-i,2*Math.PI)||w.vertices.pop(),w.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,c.z));var T=nearestVertexInVertexToEdge(c,w),x=THREE.Vector2.prototype.distanceTo.call(T,c),A=new THREE.Vector2(e,t);this.snapCandidates.push(new b(o,x).makeEllipticalArc(A,n,s,i,r)),this.ellipticalArc=w,this.ellipticalArcCenter=new THREE.Vector3(e,t,c.z),this.vpIdElliptical=o}},this.snapping2D=function(e){if(e){var t=e.intersectPoint,i=e.fragId;if(void 0!==i){if(Array.isArray(i)||(i=[i]),s.hasTopology=!1,s.intersectPoint=t,s.radius=this.setDetectRadius(t),!(null!=a.model.getFragmentList()))return A=!0,s.geomType=p.SNAP_VERTEX,void(s.geomVertex=t);for(var r=new S(a,this,s.radius),n=0;n<i.length;++n){var c=a.impl.getRenderProxy(a.model,i[n]);if(c&&c.geometry)new o(c.geometry,a.impl.use2dInstancing).enumGeomsForObject(e.dbId,r)}this.finishSnapping2D(r,t),!A&&R&&(A=!0,s.geomType=p.RASTER_PIXEL,s.geomVertex=t)}}},this.snapping2DOverlay=function(e,t,i,r){s.hasTopology=!1,s.intersectPoint=e,s.radius=this.setDetectRadius(e);for(var n=new S(a,this,s.radius),c=0;c<t.length;c++){new o(t[c].geometry,r).enumGeoms(i,n)}this.finishSnapping2D(n,e)},this.snapping2DWithSegmentEnum=function(e,t){s.hasTopology=!1,s.intersectPoint=e,s.radius=this.setDetectRadius(e);var i=new S(a,this,s.radius);t(e.x-s.radius,e.y-s.radius,e.x+s.radius,e.y+s.radius,i),this.finishSnapping2D(i,e)},this.finishSnapping2D=function(e,t){if(null!==V){e.snapCandidates=e.snapCandidates.filter((function(e){return e.viewportId===V}))}var i=w(e.snapCandidates,t,e.detectRadius);if(i)return s.viewportIndex2d=i.viewportId,s.snapPoint=i.snapPoint,s.geomType=p.SNAP_INTERSECTION,s.geomVertex=i.snapPoint,void(A=!0);if(e.circularArc){if(s.viewportIndex2d=e.vpIdCircular,null!==V&&V!==s.viewportIndex2d)return;t.distanceTo(e.circularArc.vertices[0])<s.radius?(s.geomVertex=e.circularArc.vertices[0],s.geomType=p.SNAP_VERTEX):t.distanceTo(e.circularArc.vertices[e.circularArc.vertices.length-1])<s.radius?(s.geomVertex=e.circularArc.vertices[e.circularArc.vertices.length-1],s.geomType=p.SNAP_VERTEX):(this.lineStripToPieces(e.circularArc),s.geomEdge=e.circularArc,s.circularArcCenter=e.circularArcCenter,s.circularArcRadius=e.circularArcRadius,s.geomType=p.SNAP_CIRCULARARC),A=!0}else if(e.ellipticalArc){if(s.viewportIndex2d=e.vpIdElliptical,null!==V&&V!==s.viewportIndex2d)return;t.distanceTo(e.ellipticalArc.vertices[0])<s.radius?(s.geomVertex=e.ellipticalArc.vertices[0],s.geomType=p.SNAP_VERTEX):t.distanceTo(e.ellipticalArc.vertices[e.ellipticalArc.vertices.length-1])<s.radius?(s.geomVertex=e.ellipticalArc.vertices[e.ellipticalArc.vertices.length-1],s.geomType=p.SNAP_VERTEX):(this.lineStripToPieces(e.ellipticalArc),s.geomEdge=e.ellipticalArc,s.circularArcCenter=e.ellipticalArcCenter,s.circularArcRadius=null,s.geomType=p.SNAP_CIRCULARARC),A=!0}else if(e.lineGeom.vertices.length){if(s.viewportIndex2d=e.vpIdLine,null!==V&&V!==s.viewportIndex2d)return;if(this.markupMode){var r=e.lineGeom.vertices[0],n=e.lineGeom.vertices[1],a=new THREE.Vector3;a.addVectors(r,n),a.divideScalar(2);var o=t.distanceTo(a),l=t.distanceTo(r),u=t.distanceTo(n);s.geomEdge=e.lineGeom,o<s.radius?(s.geomVertex=a,s.geomType=p.SNAP_VERTEX):l<s.radius?(s.geomVertex=r,s.geomType=p.SNAP_VERTEX):u<s.radius?(s.geomVertex=n,s.geomType=p.SNAP_VERTEX):s.geomType=p.SNAP_EDGE,e.lineGeom.vertices[0].distanceTo(e.lineGeom.vertices[1])<d&&(s.geomType=p.SNAP_CIRCLE_CENTER)}else t.distanceTo(e.lineGeom.vertices[0])<s.radius?(e.lineGeom.vertices[0].distanceTo(e.lineGeom.vertices[1])<d?s.geomType=p.SNAP_CIRCLE_CENTER:s.geomType=p.SNAP_VERTEX,s.geomVertex=e.lineGeom.vertices[0]):c.forceSnapVertices||t.distanceTo(e.lineGeom.vertices[1])<s.radius?(s.geomVertex=e.lineGeom.vertices[1],s.geomType=p.SNAP_VERTEX):(s.geomEdge=e.lineGeom,s.geomType=p.SNAP_EDGE);A=!0}},this.snappingLeaflet=function(e){if(e){var t=e.intersectPoint;s.intersectPoint=t,s.hasTopology=!1,s.radius=this.setDetectRadius(t),s.geomType=p.RASTER_PIXEL,s.geomVertex=t,A=!0}},this.snapMidpoint=function(){if(s.isMidpoint=!1,A&&s.geomType===p.SNAP_EDGE){var e=s.geomEdge,t=e.vertices[0],i=e.vertices[1],r=new THREE.Vector3((t.x+i.x)/2,(t.y+i.y)/2,(t.z+i.z)/2);s.intersectPoint.distanceTo(r)<2*s.radius&&(s.geomVertex=r,s.geomType=p.SNAP_MIDPOINT)}},this.setPerpendicular=function(e){s.isPerpendicular=e},this.lineStripToPieces=function(e){for(var t=e.vertices,i=t.length-2;i>0;i--)t.splice(i,0,t[i])},this.setDetectRadius=function(e){var t=Object(n.a)()?50:10,i=a.navigation,r=i.getCamera(),s=i.getPosition(),o=e.clone(),c=r.isPerspective?o.sub(s).length():i.getEyeVector().length(),l=i.getVerticalFov(),u=2*c*Math.tan(THREE.Math.degToRad(.5*l)),h=i.getScreenViewport(),d=window.devicePixelRatio||1;return t*u/(h.height*d)},this.handleButtonDown=function(e,t){return T=!0,!1},this.handleButtonUp=function(e,t){return T=!1,!1},this.handleMouseMove=function(e){return!T&&(this.onMouseMove({x:e.canvasX,y:e.canvasY}),!1)},this.handleSingleTap=function(e){return this.handleMouseMove(e)},this.handlePressHold=function(e){if(Object(n.a)())switch(e.type){case"press":x=!0,this.onMouseMove({x:e.canvasX,y:e.canvasY});break;case"pressup":this.onMouseMove({x:e.canvasX,y:e.canvasY}),x=!1}return!1},this.handleGesture=function(e){if(Object(n.a)()&&x)switch(e.type){case"dragstart":case"dragmove":this.onMouseMove({x:e.canvasX,y:e.canvasY});break;case"dragend":this.onMouseMove({x:e.canvasX,y:e.canvasY}),x=!1}return!1},this.onMouseDown=function(e){return this.onMouseMove(e)},this.onMouseMove=function(e){this.clearSnapped();var t=a.impl.snappingHitTest(e.x,e.y,!1);if(!t&&R){var i=a.impl.clientToViewport(e.x,e.y);t={intersectPoint:a.impl.intersectGroundViewport(i)}}return!(!t||!t.intersectPoint)&&(t.face?this.snapping3D(t):t.dbId||0===t.dbId?this.snapping2D(t):this.snappingLeaflet(t),this.snapMidpoint(),!0)}}}});
//# sourceMappingURL=Snapping.min.js.map